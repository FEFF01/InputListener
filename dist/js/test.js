!function(e,t){if("object"==typeof exports&&"object"==typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{var r=t();for(var n in r)("object"==typeof exports?exports:e)[n]=r[n]}}(window,(function(){return function(e){var t={};function r(n){if(t[n])return t[n].exports;var i=t[n]={i:n,l:!1,exports:{}};return e[n].call(i.exports,i,i.exports,r),i.l=!0,i.exports}return r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)r.d(n,i,function(t){return e[t]}.bind(null,i));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=1)}([function(e,t,r){"use strict";function n(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function i(e){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function o(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function s(e,t){return!t||"object"!==i(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function a(e){return(a=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function c(e,t){return(c=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function _(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function u(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function f(e,t,r){return t&&u(e.prototype,t),r&&u(e,r),e}var l={rotate:/^rotate$/,pinch:/^pinch$/,dragMove2:/^dragMove2$/,dragStart:/^dragStart$/,dragMove:/^dragMove$/,dragEnd:/^dragEnd$/,click:/^click$/},d=function(){function e(t,r){var n=this;_(this,e),this._activated_listener={},this._registered_listener={rotate:null,pinch:null,dragMove:null,dragStart:null,dragEnd:null,dragMove2:null,click:null,keyDown:{_parts:[],_reference:0},keyUp:{_reference:0},keyPress:{_reference:0}},this.mouse_mask=1,this.target=null,this.pointX="pageX",this.pointY="pageY",this._listener_status={},this._points=[],this._identifiers=[];var i=!1;this.target=t,r&&(!0===r?i=!0:(i=["capture","passive","passive"].forEach((function(e){void 0!==r[e]&&((i||(i={}))[e]=r[e])})),["pointX","pointY","mouse_mask"].forEach((function(e){void 0!==r[e]&&(n[e]=r[e])})))),this._listener_options=i}return f(e,[{key:"setListener",value:function(e){for(var t in e)if(!this._listener_status[t]!=!e[t]){var r=p.EVENT_CONFIG[t],n=r[0],i=r[1],o=r[2]||this.target;e[t]?o.addEventListener(n,this[i],this._listener_options):o.removeEventListener(n,this[i],this._listener_options),this._listener_status[t]=!!e[t]}}},{key:"eventDispenser",value:function(e,t){if(this._identifiers[0]===p.MOUSE_EVENT_ID)Math.pow(2,e.button)&this.mouse_mask&&t(e,e,0);else if(e.changedTouches)for(var r=0;r<e.changedTouches.length;r++){var n=this._identifiers.indexOf(e.changedTouches[r].identifier);-1!==n&&t(e,e.changedTouches[r],n)}}},{key:"_is_mouse_event",get:function(){return this._identifiers[0]===p.MOUSE_EVENT_ID}}]),e}();d.EVENT_CONFIG={MOUSE_DOWN:["mousedown","cursorDown"],MOUSE_MOVE:["mousemove","cursorMove",window],MOUSE_UP:["mouseup","cursorUp",window],TOUCH_START:["touchstart","cursorDown"],TOUCH_MOVE:["touchmove","cursorMove",window],TOUCH_END:["touchend","cursorUp",window],TOUCH_CANCEL:["touchcancel","cursorUp",window],KEY_DOWN:["keydown","keyDown"],KEY_UP:["keyup","keyUp"],KEY_PRESS:["keypress","keyPress"]},d.CURSOR_EVENT_HANDLES=Object.keys(l),d.STATES={IS_DRAG:1,IS_ROTATE:2,IS_PINCH:4,MOUSE_DOWN:"MOUSE_DOWN",MOUSE_MOVE:"MOUSE_MOVE",MOUSE_UP:"MOUSE_UP",TOUCH_START:"TOUCH_START",TOUCH_MOVE:"TOUCH_MOVE",TOUCH_END:"TOUCH_END",TOUCH_CANCEL:"TOUCH_CANCEL",KEY_DOWN:"KEY_DOWN",KEY_UP:"KEY_UP",KEY_PRESS:"KEY_PRESS"},d.PATTERN_MAP=function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?n(Object(r),!0).forEach((function(t){o(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):n(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}({},l,{},{keyDown:/^\S+_keyDown$/,keyUp:/^\S+_keyUp$/,keyPress:/^\S+_keyPress$/}),d.MOUSE_EVENT_ID=-9007199254740991,d._PRIVATE_METHODS={update_key_listener:function(e,t,r,n){p._PRIVATE_METHODS.match_keys(t,(function(t){var i=e[t];i||(i=e[t]=[]);var o=i.indexOf(r);n?o>=0&&(e._reference--,i.length>1?i.splice(o,1):delete e[t]):(e._reference++,~o||i.push(r))}))},match_keys:function(e,t){var r=e.match(/(\w+?| )(?=$|\||,|\+)/g);if(r=r?r.map((function(e){return e.toLocaleLowerCase()})):[],!t)return r;var n=r,i=Array.isArray(n),o=0;for(n=i?n:n[Symbol.iterator]();;){var s;if(i){if(o>=n.length)break;s=n[o++]}else{if((o=n.next()).done)break;s=o.value}if(t(s))break}},get_keys:function(e){return e.code&&e.key!==e.code?[e.key.toLocaleLowerCase(),e.code.toLocaleLowerCase()]:[e.key.toLocaleLowerCase()]}},d._LISTENER_PREPROCESSOR={keyDown:function(e,t,r){var n,i=e.slice(0,-8).split(","),o=r?function(e,r,n){if(n){var i=e[r];if(i){var o=i._listeners.indexOf(t);-1!==o&&(i._listeners.splice(o,1),function e(t){var r=t._parent;--t._reference<=0&&r&&(delete r[t._key],e(r))}(i))}}}:function(e,r,i){var o=e[r];o||((o=e[r]={_parent:e,_key:r,_reference:0,_parts:e._parts.concat(r)})._path=o._parts.join("+"),e._reference++),n.push(o),i&&(o._reference++,o._listeners?-1===o._listeners.indexOf(t)&&o._listeners.push(t):o._listeners=[t])};i.forEach((function(e){n=[this._registered_listener.keyDown],e.split("+").forEach((function(e,t,r){var i=n,s=p._PRIVATE_METHODS.match_keys(e),a=r.length===t+1;n=[];var c=i,_=Array.isArray(c),u=0;for(c=_?c:c[Symbol.iterator]();;){var f;if(_){if(u>=c.length)break;f=c[u++]}else{if((u=c.next()).done)break;f=u.value}var l=f,d=s,y=Array.isArray(d),v=0;for(d=y?d:d[Symbol.iterator]();;){var h;if(y){if(v>=d.length)break;h=d[v++]}else{if((v=d.next()).done)break;h=v.value}o(l,h,a)}}}),this)}),this)},keyUp:function(e,t,r){p._PRIVATE_METHODS.update_key_listener(this._registered_listener.keyUp,e,t,r)},keyPress:function(e,t,r){p._PRIVATE_METHODS.update_key_listener(this._registered_listener.keyPress,e,t,r)}};var p=function(e){function t(e,r,n){var i;return _(this,t),(i=s(this,a(t).call(this,e,n)))._mesh_value=4,i._process_status=0,i._process_values={kd_tasks:[]},i.cursorDown=function(e){var r,n=i._points;if(i._identifiers[0]!==t.MOUSE_EVENT_ID)if(e.changedTouches&&n.length<i._max_points){var o=e.changedTouches,s=Array.isArray(o),a=0;for(o=s?o:o[Symbol.iterator]();;){var c;if(s){if(a>=o.length)break;c=o[a++]}else{if((a=o.next()).done)break;c=a.value}var _=c;if(-1===i._identifiers.indexOf(_.identifier)){r=_;break}}}else 0===n.length&&Math.pow(2,e.button)&i.mouse_mask&&(r=e);r&&i.addPoint(r,e)},i._move=function(e,t,r){var n=i._activated_listener,o=i._points[r],s=t[i.pointX],a=t[i.pointY];if(n.dragMove){var c=[s-o.mx,a-o.my];n.dragMove(e,c,t)?(o.mx=s-c[0],o.my=a-c[1]):(o.mx=s,o.my=a)}n.click&&Math.abs(s-o.dx)+Math.abs(a-o.dy)>i._mesh_value&&(n.click=!1)},i._move2=function(e,r,n){var o=t.STATES,s=i._activated_listener,a=i._process_values,c=i._points,_=c[n],u=c[1===n?0:1],f=r[i.pointX]-_.mx,l=r[i.pointY]-_.my;if(s.dragMove2){var d=[f/2,l/2];s.dragMove2(e,d,r)&&(f-=2*d[0],l-=2*d[1])}_.mx=_.mx+f,_.my=_.my+l;var p=(_.mx+u.mx)/2,y=(_.my+u.my)/2;if(s.pinch){var v=Math.sqrt(Math.pow(_.mx-u.mx,2)+Math.pow(_.my-u.my,2));i._process_status&o.IS_PINCH?s.pinch(e,-(a.sd-(a.sd=v))):Math.abs(v-a.sd)>i._mesh_value&&(i._process_status|=o.IS_PINCH,s.pinch(e,-(a.sd-(a.sd=v)),[p,y]))}if(s.rotate){var h=0===n?1:n,E=c[0].mx-c[h].mx,O=c[0].my-c[h].my,k=Math.atan2(O,E);k*a.ra<=0&&(a.ra=-a.ra),i._process_status&o.IS_ROTATE?(s.rotate(e,k-a.ra),a.ra=k):Math.abs(k-a.ra)>.01*Math.PI&&(i._process_status|=o.IS_ROTATE,s.rotate(e,k-a.ra,[p,y]),a.ra=k)}},i.cursorMove=function(e){i.eventDispenser(e,i._points.length<2?i._move:i._move2)},i._leave=function(e,r,n){var s;i._identifiers.splice(n,1),i._points.splice(n,1);var a=t.STATES,c=i._identifiers.length,_=i._activated_listener;switch(!0){case c<1:i.setListener((o(s={},a.MOUSE_DOWN,!0),o(s,a.MOUSE_MOVE,!1),o(s,a.MOUSE_UP,!1),o(s,a.TOUCH_MOVE,!1),o(s,a.TOUCH_END,!1),o(s,a.TOUCH_CANCEL,!1),s)),i._process_status=0,e&&(_.dragEnd&&_.dragEnd(e,r),_.click&&_.click(e,r));break;case e&&c<i._max_points:if(i._process_status=a.IS_DRAG,e.targetTouches&&e.targetTouches.length>=i._max_points){var u=e.targetTouches,f=Array.isArray(u),l=0;for(u=f?u:u[Symbol.iterator]();;){var d;if(f){if(l>=u.length)break;d=u[l++]}else{if((l=u.next()).done)break;d=l.value}var p=d;if(-1===i._identifiers.indexOf(p.identifier)){i.registPoint(e,p);break}}}}},i.cursorUp=function(e){i.eventDispenser(e,i._leave)},i.keyDown=function(e){var r=i._process_values.kd_tasks;function n(t){if(t){for(var n=t._listeners?t._listeners.length:0,i=0;i<n;i++)if(!0===t._listeners[i](e,t._path))return!0;t._reference>n&&-1===r.indexOf(t)&&r.push(t)}}var o=t._PRIVATE_METHODS.get_keys(e);if(!r.some((function(e){return o.some((function(t){return n(e[t])}))}))){var s=o,a=Array.isArray(s),c=0;for(s=a?s:s[Symbol.iterator]();;){var _;if(a){if(c>=s.length)break;_=s[c++]}else{if((c=s.next()).done)break;_=c.value}var u=_;if(n(i._registered_listener.keyDown[u]))break}}},i.keyUp=function(e){for(var r=t._PRIVATE_METHODS.get_keys(e),n=i._process_values.kd_tasks,o=function(e){r.some((function(t){return-1!==n[e]._parts.indexOf(t)}))&&n.splice(e--,1),s=e},s=0;s<n.length;s++)o(s);var a=i._registered_listener.keyUp,c=r,_=Array.isArray(c),u=0;for(c=_?c:c[Symbol.iterator]();;){var f;if(_){if(u>=c.length)break;f=c[u++]}else{if((u=c.next()).done)break;f=u.value}var l=f;a[l]&&a[l].some((function(t){return t(e)}))}},i.keyPress=function(e){var r=t._PRIVATE_METHODS.get_keys(e),n=i._registered_listener.keyPress,o=r,s=Array.isArray(o),a=0;for(o=s?o:o[Symbol.iterator]();;){var c;if(s){if(a>=o.length)break;c=o[a++]}else{if((a=o.next()).done)break;c=a.value}var _=c;n[_]&&n[_].some((function(t){return t(e)}))}},i.registListener(r),i}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&c(e,t)}(t,e),f(t,[{key:"on",value:function(e,t){return this.updateListener(o({},e,t))}},{key:"off",value:function(e,t){return this.updateListener(o({},e,t),!0)}},{key:"activate",value:function(){this.updateListener()}},{key:"disable",value:function(){var e=this;this.setListener(Object.keys(this._listener_status).reduce((function(t,r){return e._listener_status[r]&&(t[r]=!1),t}),{}))}},{key:"updateListener",value:function(e,r){var n,i=this._registered_listener,s=t.STATES;if(e)for(var a in e)for(var c in t.PATTERN_MAP)t.PATTERN_MAP[c].test(a)&&(t._LISTENER_PREPROCESSOR[c]?e[a]&&t._LISTENER_PREPROCESSOR[c].call(this,a,e[a],r):i[c]=r?null:e[a]);this._max_points=i.pinch||i.rotate||i.dragMove2?2:1;var _=!!(i.dragStart||i.dragMove||i.dragMove2||i.dragEnd||i.click||i.pinch||i.rotate);return this.setListener((o(n={},s.MOUSE_DOWN,_),o(n,s.TOUCH_START,_),o(n,s.KEY_DOWN,i.keyDown._reference>0),o(n,s.KEY_UP,i.keyDown._reference>0||i.keyUp._reference>0),o(n,s.KEY_PRESS,i.keyPress._reference>0),n)),this}},{key:"break",value:function(){for(var e=this._identifiers.length;--e>=0;)this._leave(void 0,void 0,e)}},{key:"removePoint",value:function(e){isNaN(e)&&(e=e?this._identifiers.indexOf(e.identifier||t.MOUSE_EVENT_ID):0),this._leave(void 0,void 0,e)}},{key:"addPoint",value:function(e,r){var n=this._points,i=t.CURSOR_EVENT_HANDLES.length;if(0===n.length){var o=this._registered_listener,s=r&&o.dragStart&&o.dragStart(r,e)||!1;if(!0===s)return;i=0,t.CURSOR_EVENT_HANDLES.reduce((function(e,t){return o[t]&&(!1===s||~s.indexOf(t))?(i++,e[t]=o[t]):delete e[t],e}),this._activated_listener)}(i>1||i>0&&!this._activated_listener.dragStart)&&this.registPoint(r,e)}},{key:"registPoint",value:function(e){var r,n,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e,s=t.STATES,a=this._points,c=this._activated_listener,_=i[this.pointX],u=i[this.pointY];switch(a.push({dx:_,dy:u,mx:_,my:u}),this._identifiers.push(isNaN(i.identifier)?t.MOUSE_EVENT_ID:i.identifier),a.length){case 1:this._process_status=s.IS_DRAG,n=this._is_mouse_event,this.setListener((o(r={},s.MOUSE_DOWN,n),o(r,s.MOUSE_MOVE,n),o(r,s.MOUSE_UP,n),o(r,s.TOUCH_MOVE,!n),o(r,s.TOUCH_END,!n),o(r,s.TOUCH_CANCEL,!n),r));break;case 2:this._process_values.sd=Math.sqrt(Math.pow(a[0].mx-a[1].mx,2)+Math.pow(a[0].my-a[1].my,2)),this._process_values.ra=Math.atan2(a[0].my-a[1].my,a[0].mx-a[1].mx),c.click&&(c.click=!1)}}},{key:"registListener",value:function(e){this.updateListener(e)}},{key:"removeListener",value:function(e){e&&this.updateListener(e,!0)}}]),t}(d);try{window.InputListener=p}catch(e){}e.exports=p},function(e,t,r){var n=r(0);console.log(n),o(test_view1),o(test_view2);var i=0;function o(e){var t,r=0,o=1,s=0,a=0,c=e.querySelector("#text_view");function _(e,t){s+=t[0],a+=t[1],u()}function u(){t||(t=window.requestAnimationFrame(f))}function f(){t=null,e.style.transform="translate(".concat(s,"px,").concat(a,"px) rotate(").concat(r,"deg) scale(").concat(o,")")}function l(e){var t=document.createElement("li");t.style.cssText="display:block;width:100%;",t.innerHTML=e,c.firstChild?c.insertBefore(t,c.firstChild):c.appendChild(t)}var d=new n(e,{dragStart:function(t){t.preventDefault(),e.style.boxShadow="0 0 4px black",e.style.zIndex=++i,e.focus()},dragEnd:function(t){e.style.boxShadow=""},dragMove:_,dragMove2:_,pinch:function(t,r,n){n&&console.log("pinch",n),o*=1+r/(e.clientWidth*o),u()},rotate:function(e,t,n){n&&console.log("rotate",n),r+=180*t/Math.PI,u()},click:function(e){e.preventDefault(),console.log("click->",e)},"alt|ArrowUp+a,arrowup+a|z+s|x+d|c,s,d+f,f,d_keyDown":function(e,t){c&&l("keyDown:".concat(t)),console.log("keyDown",e,t)},"s,1,f_keyUp":function(e){c&&l("keyUp:".concat(e.code||e.key)),console.log("keyUp",e)},"s,d,e_keyPress":function(e){c&&l("keyPress:".concat(e.code||e.key)),console.log("keyPress",e)},"1,2,3,4,5,6_keyPress":function(e){c&&l("keyPress:".concat(e.code)),console.log("keyPress",e)}});console.log(d)}}])}));
//# sourceMappingURL=test.js.map