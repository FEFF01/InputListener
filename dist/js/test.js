!function(e,t){if("object"==typeof exports&&"object"==typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{var r=t();for(var n in r)("object"==typeof exports?exports:e)[n]=r[n]}}(window,(function(){return function(e){var t={};function r(n){if(t[n])return t[n].exports;var i=t[n]={i:n,l:!1,exports:{}};return e[n].call(i.exports,i,i.exports,r),i.l=!0,i.exports}return r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)r.d(n,i,function(t){return e[t]}.bind(null,i));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=1)}([function(e,t,r){"use strict";function n(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function i(e){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function o(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function s(e,t){return!t||"object"!==i(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function a(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}function c(e){return(c=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function u(e,t){return(u=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function _(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function f(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function l(e,t,r){return t&&f(e.prototype,t),r&&f(e,r),e}var d={rotate:/^rotate$/,pinch:/^pinch$/,dragMove2:/^dragMove2$/,dragStart:/^dragStart$/,dragMove:/^dragMove$/,dragEnd:/^dragEnd$/,click:/^click$/},p=function(){function e(t,r){var n=this;_(this,e),this._activated_listener={},this._registered_listener={rotate:null,pinch:null,dragMove:null,dragStart:null,dragEnd:null,dragMove2:null,click:null,keyDown:{_parts:[],_reference:0},keyUp:{_reference:0},keyPress:{_reference:0}},this.mouse_mask=1,this.target=null,this.pointX="pageX",this.pointY="pageY",this._listener_status={},this._points=[],this._identifiers=[];var i=!1;this.target=t,r&&(!0===r?i=!0:(i=["capture","passive","passive"].forEach((function(e){void 0!==r[e]&&((i||(i={}))[e]=r[e])})),["pointX","pointY","mouse_mask"].forEach((function(e){void 0!==r[e]&&(n[e]=r[e])})))),this._listener_options=i}return l(e,[{key:"setListener",value:function(e){for(var t in e)if(!this._listener_status[t]!=!e[t]){var r=y.EVENT_CONFIG[t],n=r[0],i=r[1],o=r[2]||this.target;e[t]?o.addEventListener(n,this[i],this._listener_options):o.removeEventListener(n,this[i],this._listener_options),this._listener_status[t]=!!e[t]}}},{key:"eventDispenser",value:function(e,t){if(this._identifiers[0]===y.MOUSE_EVENT_ID)Math.pow(2,e.button)&this.mouse_mask&&t(e,e,0);else if(e.changedTouches)for(var r=0;r<e.changedTouches.length;r++){var n=this._identifiers.indexOf(e.changedTouches[r].identifier);-1!==n&&t(e,e.changedTouches[r],n)}}},{key:"_is_mouse_event",get:function(){return this._identifiers[0]===y.MOUSE_EVENT_ID}}]),e}();p.EVENT_CONFIG={MOUSE_DOWN:["mousedown","cursorDown"],MOUSE_MOVE:["mousemove","cursorMove",window],MOUSE_UP:["mouseup","cursorUp",window],TOUCH_START:["touchstart","cursorDown"],TOUCH_MOVE:["touchmove","cursorMove",window],TOUCH_END:["touchend","cursorUp",window],TOUCH_CANCEL:["touchcancel","cursorUp",window],KEY_DOWN:["keydown","keyDown"],KEY_UP:["keyup","keyUp"],KEY_PRESS:["keypress","keyPress"]},p.CURSOR_EVENT_HANDLES=Object.keys(d),p.STATES={IS_DRAG:1,IS_ROTATE:2,IS_PINCH:4,MOUSE_DOWN:"MOUSE_DOWN",MOUSE_MOVE:"MOUSE_MOVE",MOUSE_UP:"MOUSE_UP",TOUCH_START:"TOUCH_START",TOUCH_MOVE:"TOUCH_MOVE",TOUCH_END:"TOUCH_END",TOUCH_CANCEL:"TOUCH_CANCEL",KEY_DOWN:"KEY_DOWN",KEY_UP:"KEY_UP",KEY_PRESS:"KEY_PRESS"},p.PATTERN_MAP=function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?n(Object(r),!0).forEach((function(t){o(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):n(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}({},d,{},{keyDown:/^\S+_keyDown$/,keyUp:/^\S+_keyUp$/,keyPress:/^\S+_keyPress$/}),p.MOUSE_EVENT_ID=-9007199254740991,p._PRIVATE_METHODS={update_key_listener:function(e,t,r,n){y._PRIVATE_METHODS.match_keys(t,(function(t){var i=e[t];i||(i=e[t]=[]);var o=i.indexOf(r);n?o>=0&&(e._reference--,i.length>1?i.splice(o,1):delete e[t]):(e._reference++,~o||i.push(r))}))},match_keys:function(e,t){var r=e.match(/(\w+?| )(?=$|\||,|\+)/g);if(r=r?r.map((function(e){return e.toLocaleLowerCase()})):[],!t)return r;var n=r,i=Array.isArray(n),o=0;for(n=i?n:n[Symbol.iterator]();;){var s;if(i){if(o>=n.length)break;s=n[o++]}else{if((o=n.next()).done)break;s=o.value}if(t(s))break}},get_keys:function(e){return e.code&&e.key!==e.code?[e.key.toLocaleLowerCase(),e.code.toLocaleLowerCase()]:[e.key.toLocaleLowerCase()]}},p._LISTENER_PREPROCESSOR={keyDown:function(e,t,r){var n,i=e.slice(0,-8).split(","),o=r?function(e,r,n){if(n){var i=e[r];if(i){var o=i._listeners.indexOf(t);-1!==o&&(i._listeners.splice(o,1),function e(t){var r=t._parent;--t._reference<=0&&r&&(delete r[t._key],e(r))}(i))}}}:function(e,r,i){var o=e[r];o||((o=e[r]={_parent:e,_key:r,_reference:0,_parts:e._parts.concat(r)})._path=o._parts.join("+"),e._reference++),n.push(o),i&&(o._reference++,o._listeners?-1===o._listeners.indexOf(t)&&o._listeners.push(t):o._listeners=[t])};i.forEach((function(e){n=[this._registered_listener.keyDown],e.split("+").forEach((function(e,t,r){var i=n,s=y._PRIVATE_METHODS.match_keys(e),a=r.length===t+1;n=[];var c=i,u=Array.isArray(c),_=0;for(c=u?c:c[Symbol.iterator]();;){var f;if(u){if(_>=c.length)break;f=c[_++]}else{if((_=c.next()).done)break;f=_.value}var l=f,d=s,p=Array.isArray(d),v=0;for(d=p?d:d[Symbol.iterator]();;){var h;if(p){if(v>=d.length)break;h=d[v++]}else{if((v=d.next()).done)break;h=v.value}o(l,h,a)}}}),this)}),this)},keyUp:function(e,t,r){y._PRIVATE_METHODS.update_key_listener(this._registered_listener.keyUp,e,t,r)},keyPress:function(e,t,r){y._PRIVATE_METHODS.update_key_listener(this._registered_listener.keyPress,e,t,r)}};var y=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&u(e,t)}(n,e);var t,r=(t=n,function(){var e,r=c(t);if(a()){var n=c(this).constructor;e=Reflect.construct(r,arguments,n)}else e=r.apply(this,arguments);return s(this,e)});function n(e,t,i){var s;return _(this,n),(s=r.call(this,e,i))._mesh_value=4,s._process_status=0,s._process_values={kd_tasks:[]},s.cursorDown=function(e){var t,r=s._points;if(s._identifiers[0]!==n.MOUSE_EVENT_ID)if(e.changedTouches&&r.length<s._max_points){var i=e.changedTouches,o=Array.isArray(i),a=0;for(i=o?i:i[Symbol.iterator]();;){var c;if(o){if(a>=i.length)break;c=i[a++]}else{if((a=i.next()).done)break;c=a.value}var u=c;if(-1===s._identifiers.indexOf(u.identifier)){t=u;break}}}else 0===r.length&&Math.pow(2,e.button)&s.mouse_mask&&(t=e);t&&s.addPoint(t,e)},s._move=function(e,t,r){var n=s._activated_listener,i=s._points[r],o=t[s.pointX],a=t[s.pointY];if(n.dragMove){var c=[o-i.mx,a-i.my];n.dragMove(e,c,t)?(i.mx=o-c[0],i.my=a-c[1]):(i.mx=o,i.my=a)}n.click&&Math.abs(o-i.dx)+Math.abs(a-i.dy)>s._mesh_value&&(n.click=!1)},s._move2=function(e,t,r){var i=n.STATES,o=s._activated_listener,a=s._process_values,c=s._points,u=c[r],_=c[1===r?0:1],f=t[s.pointX]-u.mx,l=t[s.pointY]-u.my;if(o.dragMove2){var d=[f/2,l/2];o.dragMove2(e,d,t)&&(f-=2*d[0],l-=2*d[1])}u.mx=u.mx+f,u.my=u.my+l;var p=(u.mx+_.mx)/2,y=(u.my+_.my)/2;if(o.pinch){var v=Math.sqrt(Math.pow(u.mx-_.mx,2)+Math.pow(u.my-_.my,2));s._process_status&i.IS_PINCH?o.pinch(e,-(a.sd-(a.sd=v))):Math.abs(v-a.sd)>s._mesh_value&&(s._process_status|=i.IS_PINCH,o.pinch(e,-(a.sd-(a.sd=v)),[p,y]))}if(o.rotate){var h=0===r?1:r,E=c[0].mx-c[h].mx,O=c[0].my-c[h].my,k=Math.atan2(O,E);k*a.ra<=0&&(a.ra=-a.ra),s._process_status&i.IS_ROTATE?(o.rotate(e,k-a.ra),a.ra=k):Math.abs(k-a.ra)>.01*Math.PI&&(s._process_status|=i.IS_ROTATE,o.rotate(e,k-a.ra,[p,y]),a.ra=k)}},s.cursorMove=function(e){s.eventDispenser(e,s._points.length<2?s._move:s._move2)},s._leave=function(e,t,r){var i;s._identifiers.splice(r,1),s._points.splice(r,1);var a=n.STATES,c=s._identifiers.length,u=s._activated_listener;switch(!0){case c<1:s.setListener((o(i={},a.MOUSE_DOWN,!0),o(i,a.MOUSE_MOVE,!1),o(i,a.MOUSE_UP,!1),o(i,a.TOUCH_MOVE,!1),o(i,a.TOUCH_END,!1),o(i,a.TOUCH_CANCEL,!1),i)),s._process_status=0,e&&(u.dragEnd&&u.dragEnd(e,t),u.click&&u.click(e,t));break;case e&&c<s._max_points:if(s._process_status=a.IS_DRAG,e.targetTouches&&e.targetTouches.length>=s._max_points){var _=e.targetTouches,f=Array.isArray(_),l=0;for(_=f?_:_[Symbol.iterator]();;){var d;if(f){if(l>=_.length)break;d=_[l++]}else{if((l=_.next()).done)break;d=l.value}var p=d;if(-1===s._identifiers.indexOf(p.identifier)){s.registPoint(e,p);break}}}}},s.cursorUp=function(e){s.eventDispenser(e,s._leave)},s.keyDown=function(e){var t=s._process_values.kd_tasks;function r(r){if(r){for(var n=r._listeners?r._listeners.length:0,i=0;i<n;i++)if(!0===r._listeners[i](e,r._path))return!0;r._reference>n&&-1===t.indexOf(r)&&t.push(r)}}var i=n._PRIVATE_METHODS.get_keys(e);if(!t.some((function(e){return i.some((function(t){return r(e[t])}))}))){var o=i,a=Array.isArray(o),c=0;for(o=a?o:o[Symbol.iterator]();;){var u;if(a){if(c>=o.length)break;u=o[c++]}else{if((c=o.next()).done)break;u=c.value}var _=u;if(r(s._registered_listener.keyDown[_]))break}}},s.keyUp=function(e){for(var t=n._PRIVATE_METHODS.get_keys(e),r=s._process_values.kd_tasks,i=function(e){t.some((function(t){return-1!==r[e]._parts.indexOf(t)}))&&r.splice(e--,1),o=e},o=0;o<r.length;o++)i(o);var a=s._registered_listener.keyUp,c=t,u=Array.isArray(c),_=0;for(c=u?c:c[Symbol.iterator]();;){var f;if(u){if(_>=c.length)break;f=c[_++]}else{if((_=c.next()).done)break;f=_.value}var l=f;a[l]&&a[l].some((function(t){return t(e)}))}},s.keyPress=function(e){var t=n._PRIVATE_METHODS.get_keys(e),r=s._registered_listener.keyPress,i=t,o=Array.isArray(i),a=0;for(i=o?i:i[Symbol.iterator]();;){var c;if(o){if(a>=i.length)break;c=i[a++]}else{if((a=i.next()).done)break;c=a.value}var u=c;r[u]&&r[u].some((function(t){return t(e)}))}},s.registListener(t),s}return l(n,[{key:"on",value:function(e,t){return this.updateListener(o({},e,t))}},{key:"off",value:function(e,t){return this.updateListener(o({},e,t),!0)}},{key:"activate",value:function(){this.updateListener()}},{key:"disable",value:function(){var e=this;this.setListener(Object.keys(this._listener_status).reduce((function(t,r){return e._listener_status[r]&&(t[r]=!1),t}),{}))}},{key:"updateListener",value:function(e,t){var r,i=this._registered_listener,s=n.STATES;if(e)for(var a in e)for(var c in n.PATTERN_MAP)n.PATTERN_MAP[c].test(a)&&(n._LISTENER_PREPROCESSOR[c]?e[a]&&n._LISTENER_PREPROCESSOR[c].call(this,a,e[a],t):i[c]=t?null:e[a]);this._max_points=i.pinch||i.rotate||i.dragMove2?2:1;var u=!!(i.dragStart||i.dragMove||i.dragMove2||i.dragEnd||i.click||i.pinch||i.rotate);return this.setListener((o(r={},s.MOUSE_DOWN,u),o(r,s.TOUCH_START,u),o(r,s.KEY_DOWN,i.keyDown._reference>0),o(r,s.KEY_UP,i.keyDown._reference>0||i.keyUp._reference>0),o(r,s.KEY_PRESS,i.keyPress._reference>0),r)),this}},{key:"break",value:function(){for(var e=this._identifiers.length;--e>=0;)this._leave(void 0,void 0,e)}},{key:"removePoint",value:function(e){isNaN(e)&&(e=e?this._identifiers.indexOf(e.identifier||n.MOUSE_EVENT_ID):0),this._leave(void 0,void 0,e)}},{key:"addPoint",value:function(e,t){var r=this._points,i=n.CURSOR_EVENT_HANDLES.length;if(0===r.length){var o=this._registered_listener,s=t&&o.dragStart&&o.dragStart(t,e)||!1;if(!0===s)return;i=0,n.CURSOR_EVENT_HANDLES.reduce((function(e,t){return o[t]&&(!1===s||~s.indexOf(t))?(i++,e[t]=o[t]):delete e[t],e}),this._activated_listener)}(i>1||i>0&&!this._activated_listener.dragStart)&&this.registPoint(t,e)}},{key:"registPoint",value:function(e){var t,r,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e,s=n.STATES,a=this._points,c=this._activated_listener,u=i[this.pointX],_=i[this.pointY];switch(a.push({dx:u,dy:_,mx:u,my:_}),this._identifiers.push(isNaN(i.identifier)?n.MOUSE_EVENT_ID:i.identifier),a.length){case 1:this._process_status=s.IS_DRAG,r=this._is_mouse_event,this.setListener((o(t={},s.MOUSE_DOWN,r),o(t,s.MOUSE_MOVE,r),o(t,s.MOUSE_UP,r),o(t,s.TOUCH_MOVE,!r),o(t,s.TOUCH_END,!r),o(t,s.TOUCH_CANCEL,!r),t));break;case 2:this._process_values.sd=Math.sqrt(Math.pow(a[0].mx-a[1].mx,2)+Math.pow(a[0].my-a[1].my,2)),this._process_values.ra=Math.atan2(a[0].my-a[1].my,a[0].mx-a[1].mx),c.click&&(c.click=!1)}}},{key:"registListener",value:function(e){this.updateListener(e)}},{key:"removeListener",value:function(e){e&&this.updateListener(e,!0)}}]),n}(p);try{window.InputListener=y}catch(e){}e.exports=y},function(e,t,r){var n=r(0);console.log(n),o(test_view1),o(test_view2);var i=0;function o(e){var t,r=0,o=1,s=0,a=0,c=e.querySelector("#text_view");function u(e,t){s+=t[0],a+=t[1],_()}function _(){t||(t=window.requestAnimationFrame(f))}function f(){t=null,e.style.transform="translate(".concat(s,"px,").concat(a,"px) rotate(").concat(r,"deg) scale(").concat(o,")")}function l(e){var t=document.createElement("li");t.style.cssText="display:block;width:100%;",t.innerHTML=e,c.firstChild?c.insertBefore(t,c.firstChild):c.appendChild(t)}var d=new n(e,{dragStart:function(t){t.preventDefault(),e.style.boxShadow="0 0 4px black",e.style.zIndex=++i,e.focus()},dragEnd:function(t){e.style.boxShadow=""},dragMove:u,dragMove2:u,pinch:function(t,r,n){n&&console.log("pinch",n),o*=1+r/(e.clientWidth*o),_()},rotate:function(e,t,n){n&&console.log("rotate",n),r+=180*t/Math.PI,_()},click:function(e){e.preventDefault(),console.log("click->",e)},"alt|ArrowUp+a,arrowup+a|z+s|x+d|c,s,d+f,f,d_keyDown":function(e,t){c&&l("keyDown:".concat(t)),console.log("keyDown",e,t)},"s,1,f_keyUp":function(e){c&&l("keyUp:".concat(e.code||e.key)),console.log("keyUp",e)},"s,d,e_keyPress":function(e){c&&l("keyPress:".concat(e.code||e.key)),console.log("keyPress",e)},"1,2,3,4,5,6_keyPress":function(e){c&&l("keyPress:".concat(e.code)),console.log("keyPress",e)}});console.log(d)}}])}));
//# sourceMappingURL=test.js.map