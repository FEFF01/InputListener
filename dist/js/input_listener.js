!function(e,t){if("object"==typeof exports&&"object"==typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{var r=t();for(var n in r)("object"==typeof exports?exports:e)[n]=r[n]}}(window,(function(){return function(e){var t={};function r(n){if(t[n])return t[n].exports;var i=t[n]={i:n,l:!1,exports:{}};return e[n].call(i.exports,i,i.exports,r),i.l=!0,i.exports}return r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)r.d(n,i,function(t){return e[t]}.bind(null,i));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=0)}([function(e,t,r){"use strict";function n(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function i(e){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function s(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function o(e,t){return!t||"object"!==i(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function a(e){return(a=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function _(e,t){return(_=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function c(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function u(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function f(e,t,r){return t&&u(e.prototype,t),r&&u(e,r),e}var l={rotate:/^rotate$/,pinch:/^pinch$/,dragMove2:/^dragMove2$/,dragStart:/^dragStart$/,dragMove:/^dragMove$/,dragEnd:/^dragEnd$/,click:/^click$/},p=function(){function e(t,r){c(this,e),this._activated_listener={},this._registered_listener={rotate:null,pinch:null,dragMove:null,dragStart:null,dragEnd:null,dragMove2:null,click:null,keyDown:{_parts:[],_reference:0},keyUp:{_reference:0},keyPress:{_reference:0}},this._bm=1,this.target=null,this._listener_options=void 0,this._listener_status={},this._points=[],this._identifiers=[],this.target=t,this._listener_options=r}return f(e,[{key:"setListener",value:function(e){for(var t in e)if(!this._listener_status[t]!=!e[t]){var r=d.EVENT_CONFIG[t],n=r[0],i=r[1],s=r[2]||this.target;e[t]?s.addEventListener(n,this[i],this._listener_options):s.removeEventListener(n,this[i],this._listener_options),this._listener_status[t]=!!e[t]}}},{key:"eventDispenser",value:function(e,t){if(this._identifiers[0]===d.MOUSE_EVENT_ID)Math.pow(2,e.button)&this._bm&&t(e,e,0);else if(e.changedTouches)for(var r=0;r<e.changedTouches.length;r++){var n=this._identifiers.indexOf(e.changedTouches[r].identifier);-1!==n&&t(e,e.changedTouches[r],n)}}},{key:"_is_mouse_event",get:function(){return this._identifiers[0]===d.MOUSE_EVENT_ID}}]),e}();p.EVENT_CONFIG={MOUSE_DOWN:["mousedown","cursorDown"],MOUSE_MOVE:["mousemove","cursorMove",window],MOUSE_UP:["mouseup","cursorUp",window],TOUCH_START:["touchstart","cursorDown"],TOUCH_MOVE:["touchmove","cursorMove",window],TOUCH_END:["touchend","cursorUp",window],TOUCH_CANCEL:["touchcancel","cursorUp",window],KEY_DOWN:["keydown","keyDown"],KEY_UP:["keyup","keyUp"],KEY_PRESS:["keypress","keyPress"]},p.CURSOR_EVENT_HANDLES=Object.keys(l),p.STATES={IS_DRAG:1,IS_ROTATE:2,IS_PINCH:4,MOUSE_DOWN:"MOUSE_DOWN",MOUSE_MOVE:"MOUSE_MOVE",MOUSE_UP:"MOUSE_UP",TOUCH_START:"TOUCH_START",TOUCH_MOVE:"TOUCH_MOVE",TOUCH_END:"TOUCH_END",TOUCH_CANCEL:"TOUCH_CANCEL",KEY_DOWN:"KEY_DOWN",KEY_UP:"KEY_UP",KEY_PRESS:"KEY_PRESS"},p.PATTERN_MAP=function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?n(Object(r),!0).forEach((function(t){s(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):n(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}({},l,{},{keyDown:/^\S+_keyDown$/,keyUp:/^\S+_keyUp$/,keyPress:/^\S+_keyPress$/}),p.MOUSE_EVENT_ID=-9007199254740991,p._PRIVATE_METHODS={update_key_listener:function(e,t,r,n){d._PRIVATE_METHODS.match_keys(t,(function(t){var i=e[t];i||(i=e[t]=[]);var s=i.indexOf(r);n?s>=0&&(e._reference--,i.length>1?i.splice(s,1):delete e[t]):(e._reference++,~s||i.push(r))}))},match_keys:function(e,t){var r=e.match(/(\w+?|\ )(?=$|\||\,|\+)/g);if(r=r?r.map((function(e){return e.toLocaleLowerCase()})):[],!t)return r;var n=r,i=Array.isArray(n),s=0;for(n=i?n:n[Symbol.iterator]();;){var o;if(i){if(s>=n.length)break;o=n[s++]}else{if((s=n.next()).done)break;o=s.value}if(t(o))break}},get_keys:function(e){return e.code&&e.key!==e.code?[e.key.toLocaleLowerCase(),e.code.toLocaleLowerCase()]:[e.key.toLocaleLowerCase()]}},p._LISTENER_PREPROCESSOR={keyDown:function(e,t,r){var n,i=e.slice(0,-8).split(","),s=r?function(e,r,n){if(n){var i=e[r];if(i){var s=i._listeners.indexOf(t);-1!==s&&(i._listeners.splice(s,1),function e(t){var r=t._parent;--t._reference<=0&&r&&(delete r[t._key],e(r))}(i))}}}:function(e,r,i){var s=e[r];s||((s=e[r]={_parent:e,_key:r,_reference:0,_parts:e._parts.concat(r)})._path=s._parts.join("+"),e._reference++),n.push(s),i&&(s._reference++,s._listeners?-1===s._listeners.indexOf(t)&&s._listeners.push(t):s._listeners=[t])};i.forEach((function(e){n=[this._registered_listener.keyDown],e.split("+").forEach((function(e,t,r){var i=n,o=d._PRIVATE_METHODS.match_keys(e),a=r.length===t+1;n=[];var _=i,c=Array.isArray(_),u=0;for(_=c?_:_[Symbol.iterator]();;){var f;if(c){if(u>=_.length)break;f=_[u++]}else{if((u=_.next()).done)break;f=u.value}var l=f,p=o,y=Array.isArray(p),v=0;for(p=y?p:p[Symbol.iterator]();;){var h;if(y){if(v>=p.length)break;h=p[v++]}else{if((v=p.next()).done)break;h=v.value}s(l,h,a)}}}),this)}),this)},keyUp:function(e,t,r){d._PRIVATE_METHODS.update_key_listener(this._registered_listener.keyUp,e,t,r)},keyPress:function(e,t,r){d._PRIVATE_METHODS.update_key_listener(this._registered_listener.keyPress,e,t,r)}};var d=function(e){function t(e,r,n){var i;return c(this,t),(i=o(this,a(t).call(this,e,n)))._mesh_value=4*(window.devicePixelRatio||1),i._process_status=0,i._process_values={kd_tasks:[]},i.cursorDown=function(e){var r,n=i._points;if(i._identifiers[0]!==t.MOUSE_EVENT_ID)if(e.changedTouches&&n.length<i._max_points){var s=e.changedTouches,o=Array.isArray(s),a=0;for(s=o?s:s[Symbol.iterator]();;){var _;if(o){if(a>=s.length)break;_=s[a++]}else{if((a=s.next()).done)break;_=a.value}var c=_;if(-1===i._identifiers.indexOf(c.identifier)){r=c;break}}}else 0===n.length&&Math.pow(2,e.button)&i._bm&&(r=e);if(r){var u=t.CURSOR_EVENT_HANDLES.length;if(0===n.length){var f=i._registered_listener,l=f.dragStart&&f.dragStart(e,r)||!1;if(!0===l)return;u=0,t.CURSOR_EVENT_HANDLES.reduce((function(e,t){return f[t]&&(!1===l||~l.indexOf(t))?(u++,e[t]=f[t]):delete e[t],e}),i._activated_listener)}(u>1||u>0&&!activated_listener.dragStart)&&i._registPoint(e,r)}},i._move=function(e,t,r){var n=i._activated_listener,s=i._points[r];if(n.dragMove){var o=[t.pageX-s.mx,t.pageY-s.my];n.dragMove(e,o)?(s.mx=t.pageX-o[0],s.my=t.pageY-o[1]):(s.mx=t.pageX,s.my=t.pageY)}n.click&&Math.abs(t.pageX-s.dx)+Math.abs(t.pageY-s.dy)>i._mesh_value&&(n.click=!1)},i._move2=function(e,r,n){var s=t.STATES,o=i._activated_listener,a=i._process_values,_=i._points,c=_[n],u=_[1===n?0:1],f=r.pageX-c.mx,l=r.pageY-c.my;if(o.dragMove2){var p=[f/2,l/2];o.dragMove2(e,p)&&(f-=2*p[0],l-=2*p[1])}c.mx=c.mx+f,c.my=c.my+l;var d=(c.mx+u.mx)/2,y=(c.my+u.my)/2;if(o.pinch){var v=Math.sqrt(Math.pow(c.mx-u.mx,2)+Math.pow(c.my-u.my,2));i._process_status&s.IS_PINCH?o.pinch(e,-(a.sd-(a.sd=v))):Math.abs(v-a.sd)>i._mesh_value&&(i._process_status|=s.IS_PINCH,o.pinch(e,-(a.sd-(a.sd=v)),[d,y]))}if(o.rotate){var h=0===n?1:n,E=_[0].mx-_[h].mx,O=_[0].my-_[h].my,g=Math.atan2(O,E);g*a.ra<=0&&(a.ra=-a.ra),i._process_status&s.IS_ROTATE?(o.rotate(e,g-a.ra),a.ra=g):Math.abs(g-a.ra)>.01*Math.PI&&(i._process_status|=s.IS_ROTATE,o.rotate(e,g-a.ra,[d,y]),a.ra=g)}},i.cursorMove=function(e){i.eventDispenser(e,i._points.length<2?i._move:i._move2)},i._leave=function(e,r,n){var o;i._identifiers.splice(n,1),i._points.splice(n,1);var a=t.STATES,_=i._identifiers.length,c=i._activated_listener;switch(!0){case _<1:i.setListener((s(o={},a.MOUSE_DOWN,!0),s(o,a.MOUSE_MOVE,!1),s(o,a.MOUSE_UP,!1),s(o,a.TOUCH_MOVE,!1),s(o,a.TOUCH_END,!1),s(o,a.TOUCH_CANCEL,!1),o)),i._process_status=0,c.dragEnd&&c.dragEnd(e,r),c.click&&c.click(e,r);break;case _<i._max_points:if(i._process_status=a.IS_DRAG,e.targetTouches&&e.targetTouches.length>=i._max_points){var u=e.targetTouches,f=Array.isArray(u),l=0;for(u=f?u:u[Symbol.iterator]();;){var p;if(f){if(l>=u.length)break;p=u[l++]}else{if((l=u.next()).done)break;p=l.value}var d=p;if(-1===i._identifiers.indexOf(d.identifier)){i._registPoint(e,d);break}}}}},i.cursorUp=function(e){i.eventDispenser(e,i._leave)},i.keyDown=function(e){var r=i._process_values.kd_tasks;function n(t){if(t){for(var n=t._listeners?t._listeners.length:0,i=0;i<n;i++)if(!0===t._listeners[i](e,t._path))return!0;t._reference>n&&-1===r.indexOf(t)&&r.push(t)}}var s=t._PRIVATE_METHODS.get_keys(e);if(!r.some((function(e){return s.some((function(t){return n(e[t])}))}))){var o=s,a=Array.isArray(o),_=0;for(o=a?o:o[Symbol.iterator]();;){var c;if(a){if(_>=o.length)break;c=o[_++]}else{if((_=o.next()).done)break;c=_.value}var u=c;if(n(i._registered_listener.keyDown[u]))break}}},i.keyUp=function(e){for(var r=t._PRIVATE_METHODS.get_keys(e),n=i._process_values.kd_tasks,s=function(e){r.some((function(t){return-1!==n[e]._parts.indexOf(t)}))&&n.splice(e--,1),o=e},o=0;o<n.length;o++)s(o);var a=i._registered_listener.keyUp,_=r,c=Array.isArray(_),u=0;for(_=c?_:_[Symbol.iterator]();;){var f;if(c){if(u>=_.length)break;f=_[u++]}else{if((u=_.next()).done)break;f=u.value}var l=f;a[l]&&a[l].some((function(t){return t(e)}))}},i.keyPress=function(e){var r=t._PRIVATE_METHODS.get_keys(e),n=i._registered_listener.keyPress,s=r,o=Array.isArray(s),a=0;for(s=o?s:s[Symbol.iterator]();;){var _;if(o){if(a>=s.length)break;_=s[a++]}else{if((a=s.next()).done)break;_=a.value}var c=_;n[c]&&n[c].some((function(t){return t(e)}))}},i.registListener(r),i}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&_(e,t)}(t,e),f(t,[{key:"on",value:function(e,t){return this.updateListener(s({},e,t))}},{key:"off",value:function(e,t){return this.updateListener(s({},e,t),!0)}},{key:"activate",value:function(){this.updateListener()}},{key:"disable",value:function(){var e=this;this.setListener(Object.keys(this._listener_status).reduce((function(t,r){return e._listener_status[r]&&(t[r]=!1),t}),{}))}},{key:"updateListener",value:function(e,r){var n,i=this._registered_listener,o=t.STATES;if(e)for(var a in e)for(var _ in t.PATTERN_MAP)t.PATTERN_MAP[_].test(a)&&(t._LISTENER_PREPROCESSOR[_]?e[a]&&t._LISTENER_PREPROCESSOR[_].call(this,a,e[a],r):i[_]=r?null:e[a]);this._max_points=i.pinch||i.rotate||i.dragMove2?2:1;var c=!!(i.dragStart||i.dragMove||i.dragMove2||i.dragEnd||i.click||i.pinch||i.rotate);return this.setListener((s(n={},o.MOUSE_DOWN,c),s(n,o.TOUCH_START,c),s(n,o.KEY_DOWN,i.keyDown._reference>0),s(n,o.KEY_UP,i.keyDown._reference>0||i.keyUp._reference>0),s(n,o.KEY_PRESS,i.keyPress._reference>0),n)),this}},{key:"_registPoint",value:function(e,r){var n,i=t.STATES,o=this._points,a=this._activated_listener;switch(o.push({dx:r.pageX,dy:r.pageY,mx:r.pageX,my:r.pageY}),this._identifiers.push(isNaN(r.identifier)?t.MOUSE_EVENT_ID:r.identifier),o.length){case 1:this._process_status=i.IS_DRAG;var _=this._is_mouse_event;this.setListener((s(n={},i.MOUSE_DOWN,_),s(n,i.MOUSE_MOVE,_),s(n,i.MOUSE_UP,_),s(n,i.TOUCH_MOVE,!_),s(n,i.TOUCH_END,!_),s(n,i.TOUCH_CANCEL,!_),n));break;case 2:this._process_values.sd=Math.sqrt(Math.pow(o[0].mx-o[1].mx,2)+Math.pow(o[0].my-o[1].my,2)),this._process_values.ra=Math.atan2(o[0].my-o[1].my,o[0].mx-o[1].mx),a.click&&(a.click=!1)}}},{key:"registListener",value:function(e){this.updateListener(e)}},{key:"removeListener",value:function(e){e&&this.updateListener(e,!0)}}]),t}(p);try{window.InputListener=d}catch(e){}e.exports=d}])}));
//# sourceMappingURL=input_listener.js.map