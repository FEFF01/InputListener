{"version":3,"sources":["webpack:///webpack/universalModuleDefinition","webpack:///webpack/bootstrap","webpack:///./js/input_listener.js"],"names":["root","factory","exports","module","define","amd","a","i","window","installedModules","__webpack_require__","moduleId","l","modules","call","m","c","d","name","getter","o","Object","defineProperty","enumerable","get","r","Symbol","toStringTag","value","t","mode","__esModule","ns","create","key","bind","n","object","property","prototype","hasOwnProperty","p","s","CURSOR_PATTERN_MAP","Base","target","options","_activated_listener","_registered_listener","rotate","pinch","dragMove","dragStart","dragEnd","dragMove2","click","keyDown","_parts","_reference","keyUp","keyPress","mouse_mask","pointX","pointY","_listener_status","_points","_identifiers","_listener_options","this","forEach","undefined","status","config","InputListener","EVENT_CONFIG","event","handle","addEventListener","removeEventListener","e","receiver","MOUSE_EVENT_ID","button","changedTouches","length","index","indexOf","identifier","MOUSE_DOWN","MOUSE_MOVE","MOUSE_UP","TOUCH_START","TOUCH_MOVE","TOUCH_END","TOUCH_CANCEL","KEY_DOWN","KEY_UP","KEY_PRESS","CURSOR_EVENT_HANDLES","keys","STATES","IS_DRAG","IS_ROTATE","IS_PINCH","PATTERN_MAP","_PRIVATE_METHODS","update_key_listener","storage","callback","is_remove","match_keys","callback_list","splice","push","str","match","map","toLocaleLowerCase","get_keys","code","_LISTENER_PREPROCESSOR","events","nodes","keygroups","slice","split","append_key","parent","key_code","is_last_child","child","_listeners","dec_ref","_parent","_key","concat","_path","join","keygroup","part","parts","curr_nodes","node","_mesh_value","_process_status","_process_values","kd_tasks","cursorDown","points","_max_points","touche","addPoint","_move","listener","point","point_x","point_y","v2","mx","my","Math","abs","dx","dy","_move2","values","target_point","sib_point","ox","oy","_v2","cx","cy","_sd","sqrt","sd","reference_index","_ra","atan2","ra","PI","cursorMove","eventDispenser","_leave","setListener","targetTouches","registPoint","cursorUp","dispose_task","task","cl_count","some","registListener","updateListener","reduce","res","test","has_cursor","isNaN","listener_count","listeners","mask","is_mouse_event","activated_listener","_is_mouse_event"],"mappings":"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","file":"js/input_listener.js","sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory();\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine([], factory);\n\telse {\n\t\tvar a = factory();\n\t\tfor(var i in a) (typeof exports === 'object' ? exports : root)[i] = a[i];\n\t}\n})(window, function() {\nreturn "," \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 0);\n","\"use strict\";\r\n\r\nconst CURSOR_PATTERN_MAP = {\r\n    \"rotate\": /^rotate$/,\r\n    \"pinch\": /^pinch$/,\r\n    \"dragMove2\": /^dragMove2$/,\r\n    \"dragStart\": /^dragStart$/,\r\n    \"dragMove\": /^dragMove$/,\r\n    \"dragEnd\": /^dragEnd$/,\r\n    \"click\": /^click$/,\r\n}\r\nconst KEY_PATTERN_MAP = {\r\n    \"keyDown\": /^\\S+_keyDown$/,\r\n    \"keyUp\": /^\\S+_keyUp$/,\r\n    \"keyPress\": /^\\S+_keyPress$/,\r\n}\r\n\r\nclass Base {\r\n    static EVENT_CONFIG = {\r\n        MOUSE_DOWN: [\"mousedown\", \"cursorDown\"],\r\n        MOUSE_MOVE: [\"mousemove\", \"cursorMove\", window],\r\n        MOUSE_UP: [\"mouseup\", \"cursorUp\", window],\r\n        TOUCH_START: [\"touchstart\", \"cursorDown\"],\r\n        TOUCH_MOVE: [\"touchmove\", \"cursorMove\", window],\r\n        TOUCH_END: [\"touchend\", \"cursorUp\", window],\r\n        TOUCH_CANCEL: [\"touchcancel\", \"cursorUp\", window],\r\n\r\n        KEY_DOWN: [\"keydown\", \"keyDown\"],\r\n        KEY_UP: [\"keyup\", \"keyUp\"],\r\n        KEY_PRESS: [\"keypress\", \"keyPress\"],\r\n    };\r\n    static CURSOR_EVENT_HANDLES = Object.keys(CURSOR_PATTERN_MAP);\r\n    static STATES = {\r\n        IS_DRAG: 0b1,\r\n        IS_ROTATE: 0b10,\r\n        IS_PINCH: 0b100,\r\n\r\n        MOUSE_DOWN: \"MOUSE_DOWN\",\r\n        MOUSE_MOVE: \"MOUSE_MOVE\",\r\n        MOUSE_UP: \"MOUSE_UP\",\r\n        TOUCH_START: \"TOUCH_START\",\r\n        TOUCH_MOVE: \"TOUCH_MOVE\",\r\n        TOUCH_END: \"TOUCH_END\",\r\n        TOUCH_CANCEL: \"TOUCH_CANCEL\",\r\n\r\n        KEY_DOWN: \"KEY_DOWN\",\r\n        KEY_UP: \"KEY_UP\",\r\n        KEY_PRESS: \"KEY_PRESS\",\r\n    };\r\n\r\n    static PATTERN_MAP = {\r\n        ...CURSOR_PATTERN_MAP,\r\n        ...KEY_PATTERN_MAP\r\n    };\r\n\r\n    static MOUSE_EVENT_ID = -9007199254740991;\r\n\r\n    static _PRIVATE_METHODS = {\r\n        update_key_listener(storage, handle, callback, is_remove) {\r\n            InputListener._PRIVATE_METHODS.match_keys(handle, key => {\r\n                let callback_list = storage[key];\r\n                callback_list || (callback_list = storage[key] = []);\r\n                let index = callback_list.indexOf(callback);\r\n                if (!is_remove) {\r\n                    storage._reference++;\r\n                    ~index || callback_list.push(callback);\r\n                } else if (index >= 0) {\r\n                    storage._reference--;\r\n                    if (callback_list.length > 1) {\r\n                        callback_list.splice(index, 1);\r\n                    } else {\r\n                        delete storage[key];\r\n                    }\r\n                }\r\n            });\r\n        },\r\n        match_keys(str, callback) {\r\n            //let keys = str.match(/(0x[0-9a-fA-F]+?|[0-9]+?)(?=0x|$|\\||\\,|\\+|\\_)/g) || [];\r\n            let keys = str.match(/(\\w+?| )(?=$|\\||,|\\+)/g);\r\n            keys = keys ? keys.map(key => key.toLocaleLowerCase()) : [];\r\n            if (callback) {\r\n                for (const key of keys) {\r\n                    if (callback(key)) {\r\n                        break;\r\n                    }\r\n                }\r\n            } else {\r\n                return keys;\r\n            }\r\n\r\n        },\r\n        get_keys(e) {\r\n            return (e.code && e.key !== e.code) ? [e.key.toLocaleLowerCase(), e.code.toLocaleLowerCase()] : [e.key.toLocaleLowerCase()];\r\n        }\r\n    }\r\n    static _LISTENER_PREPROCESSOR = {\r\n        keyDown(events, callback, is_remove) {\r\n            function dec_ref(child) {\r\n                let parent = child._parent;\r\n                if (--child._reference <= 0 && parent) {\r\n                    delete parent[child._key];\r\n                    dec_ref(parent);\r\n                }\r\n            }\r\n            let keygroups = events.slice(0, -8).split(\",\"),\r\n                nodes;\r\n            let append_key = is_remove ? function (parent, key_code, is_last_child) {\r\n                if (is_last_child) {\r\n                    let child = parent[key_code];\r\n                    if (child) {\r\n                        let index = child._listeners.indexOf(callback);\r\n                        if (index !== -1) {\r\n                            child._listeners.splice(index, 1);\r\n                            dec_ref(child);\r\n                        }\r\n                    }\r\n                }\r\n            } : function (parent, key_code, is_last_child) {\r\n                let child = parent[key_code];\r\n                if (!child) {\r\n                    child = parent[key_code] = {\r\n                        _parent: parent,\r\n                        _key: key_code,\r\n                        _reference: 0,\r\n                        _parts: parent._parts.concat(key_code)\r\n                    };\r\n                    child._path = child._parts.join(\"+\");\r\n                    parent._reference++;\r\n                }\r\n                nodes.push(child);\r\n                if (is_last_child) {\r\n                    child._reference++;\r\n                    child._listeners ? (child._listeners.indexOf(callback) === -1 && child._listeners.push(callback)) : child._listeners = [callback];\r\n                }\r\n            };\r\n            /*解析相关的单键监听与组合键监听*/\r\n            keygroups.forEach(function (keygroup) {\r\n                nodes = [this._registered_listener.keyDown];\r\n                keygroup.split(\"+\").forEach(function (part, index, parts) {\r\n                    let curr_nodes = nodes,\r\n                        keys = InputListener._PRIVATE_METHODS.match_keys(part),//part.match(/(0x[0-9a-fA-F]+?|[0-9]+?)(?=0x|$|\\|)/g)\r\n                        is_last_child = parts.length === index + 1;\r\n                    nodes = [];\r\n                    for (const node of curr_nodes) {\r\n                        for (const key of keys) {\r\n                            append_key(node, key, is_last_child);\r\n                        }\r\n                    }\r\n                }, this);\r\n            }, this);\r\n        },\r\n        keyUp(handle, callback, is_remove) {\r\n            InputListener._PRIVATE_METHODS.update_key_listener(this._registered_listener.keyUp, handle, callback, is_remove);\r\n        },\r\n        keyPress(handle, callback, is_remove) {\r\n            InputListener._PRIVATE_METHODS.update_key_listener(this._registered_listener.keyPress, handle, callback, is_remove);\r\n        }\r\n    };\r\n    _activated_listener = {};\r\n    _registered_listener = {\r\n        rotate: null, pinch: null,\r\n        dragMove: null, dragStart: null, dragEnd: null, dragMove2: null,\r\n        click: null,\r\n        keyDown: { _parts: [], _reference: 0 }, keyUp: { _reference: 0 }, keyPress: { _reference: 0 }\r\n    };\r\n    mouse_mask = 0x001;\r\n    target = null;\r\n    pointX = \"pageX\";\r\n    pointY = \"pageY\";\r\n    _listener_options;\r\n    constructor(target, options) {\r\n        let _listener_options = false;\r\n        this.target = target;\r\n        if (options) {\r\n            if (options === true) {\r\n                _listener_options = true;\r\n            } else {\r\n                [\"capture\", \"passive\", \"passive\"].forEach(key => {\r\n                    if (options[key] !== undefined) {\r\n                        (_listener_options || (_listener_options = {}))[key] = options[key];\r\n                    }\r\n                });\r\n                [\"pointX\", \"pointY\", \"mouse_mask\"].forEach(key => {\r\n                    options[key] !== undefined && (this[key] = options[key]);\r\n                });\r\n            }\r\n        }\r\n        this._listener_options = _listener_options;\r\n    }\r\n\r\n    _listener_status = {};\r\n    setListener(status) {\r\n        for (const key in status) {\r\n            if (!this._listener_status[key] != !status[key]) {\r\n                const config = InputListener.EVENT_CONFIG[key];\r\n                const event = config[0], handle = config[1];\r\n                const target = config[2] || this.target;\r\n                if (status[key]) {\r\n                    target.addEventListener(event, this[handle], this._listener_options);\r\n                } else {\r\n                    target.removeEventListener(event, this[handle], this._listener_options);\r\n                }\r\n                this._listener_status[key] = !!status[key];\r\n            }\r\n        }\r\n    }\r\n    _points = [];\r\n    _identifiers = [];\r\n    eventDispenser(e, receiver) {\r\n        if (this._identifiers[0] === InputListener.MOUSE_EVENT_ID) {\r\n            if (2 ** e.button & this.mouse_mask) {\r\n                receiver(e, e, 0);\r\n            }\r\n        } else if (e.changedTouches) {\r\n            for (let i = 0; i < e.changedTouches.length; i++) {\r\n                let index = this._identifiers.indexOf(e.changedTouches[i].identifier);\r\n                if (index !== -1) {\r\n                    receiver(e, e.changedTouches[i], index);\r\n                }\r\n            }\r\n        }\r\n    }\r\n    get _is_mouse_event() {\r\n        return this._identifiers[0] === InputListener.MOUSE_EVENT_ID;\r\n    }\r\n}\r\n\r\nclass InputListener extends Base {\r\n    _mesh_value = 4 /*/ (window.devicePixelRatio || 1)*/;\r\n    _process_status = 0;\r\n    _process_values = {\r\n        kd_tasks: []\r\n    };\r\n    constructor(target, events, options) {\r\n        super(target, options);\r\n        this.registListener(events);\r\n    }\r\n    on(event, callback) {\r\n        return this.updateListener({\r\n            [event]: callback\r\n        });\r\n    }\r\n    off(event, callback) {\r\n        return this.updateListener({\r\n            [event]: callback\r\n        }, true);\r\n    }\r\n    activate() {\r\n        this.updateListener();\r\n    }\r\n    disable() {\r\n        this.setListener(Object.keys(this._listener_status).reduce((res, key) => {\r\n            this._listener_status[key] && (res[key] = false);\r\n            return res;\r\n        }, {}));\r\n    }\r\n    updateListener(events, is_remove) {\r\n        let listener = this._registered_listener;\r\n        const STATES = InputListener.STATES;\r\n        if (events) {\r\n            for (let name in events) {\r\n                for (let handle in InputListener.PATTERN_MAP) {\r\n                    if (InputListener.PATTERN_MAP[handle].test(name)) {\r\n                        if (InputListener._LISTENER_PREPROCESSOR[handle]) {\r\n                            events[name] &&\r\n                                InputListener._LISTENER_PREPROCESSOR[handle].call(this, name, events[name], is_remove)\r\n                        } else {\r\n                            listener[handle] = is_remove ? null : events[name];\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n        }\r\n        this._max_points = listener.pinch || listener.rotate || listener.dragMove2 ? 2 : 1;\r\n\r\n        let has_cursor = (listener.dragStart || listener.dragMove || listener.dragMove2 || listener.dragEnd ||\r\n            listener.click || listener.pinch || listener.rotate) ? true : false;\r\n        this.setListener({\r\n            [STATES.MOUSE_DOWN]: has_cursor,\r\n            [STATES.TOUCH_START]: has_cursor,\r\n            [STATES.KEY_DOWN]: listener.keyDown._reference > 0,\r\n            [STATES.KEY_UP]: listener.keyDown._reference > 0 || listener.keyUp._reference > 0,\r\n            [STATES.KEY_PRESS]: listener.keyPress._reference > 0\r\n        });\r\n        return this;\r\n    }\r\n    break() {\r\n        let index = this._identifiers.length;\r\n        while (--index >= 0) {\r\n            this._leave(undefined, undefined, index);\r\n        }\r\n    }\r\n    removePoint(index) {\r\n        if (isNaN(index)) {\r\n            if (index) {\r\n                index = this._identifiers.indexOf(index.identifier || InputListener.MOUSE_EVENT_ID);\r\n            } else {\r\n                index = 0;\r\n            }\r\n        }\r\n        this._leave(undefined, undefined, index);\r\n    }\r\n    addPoint(t, e) {\r\n        let points = this._points;\r\n        let listener_count = InputListener.CURSOR_EVENT_HANDLES.length;\r\n        if (points.length === 0) {\r\n            let listeners = this._registered_listener;\r\n            let mask = e && (listeners.dragStart && listeners.dragStart(e, t)) || false;\r\n            if (mask === true) {\r\n                return;\r\n            }\r\n            listener_count = 0\r\n            InputListener.CURSOR_EVENT_HANDLES.reduce(\r\n                (res, handle) => {\r\n                    if (listeners[handle] && (mask === false || ~mask.indexOf(handle))) {\r\n                        listener_count++;\r\n                        res[handle] = listeners[handle];\r\n                    } else {\r\n                        delete res[handle];\r\n                    }\r\n                    return res;\r\n                }, this._activated_listener\r\n            )\r\n        }\r\n        if (listener_count > 1 || (listener_count > 0 && !this._activated_listener.dragStart)) {\r\n            this.registPoint(e, t);\r\n        }\r\n    }\r\n    registPoint(e, t = e) {\r\n        const STATES = InputListener.STATES;\r\n        let points = this._points;\r\n        let activated_listener = this._activated_listener;\r\n        let dx = t[this.pointX];\r\n        let dy = t[this.pointY];\r\n        points.push({\r\n            dx,\r\n            dy,\r\n            mx: dx,\r\n            my: dy\r\n        });\r\n        this._identifiers.push(isNaN(t.identifier) ? InputListener.MOUSE_EVENT_ID : t.identifier);\r\n        let is_mouse_event;\r\n        switch (points.length) {\r\n            case 1:\r\n                this._process_status = STATES.IS_DRAG;\r\n                is_mouse_event = this._is_mouse_event;\r\n                this.setListener({\r\n                    [STATES.MOUSE_DOWN]: is_mouse_event,\r\n                    [STATES.MOUSE_MOVE]: is_mouse_event,\r\n                    [STATES.MOUSE_UP]: is_mouse_event,\r\n                    [STATES.TOUCH_MOVE]: !is_mouse_event,\r\n                    [STATES.TOUCH_END]: !is_mouse_event,\r\n                    [STATES.TOUCH_CANCEL]: !is_mouse_event,\r\n                });\r\n                break;\r\n            case 2:\r\n                this._process_values.sd = Math.sqrt((points[0].mx - points[1].mx) ** 2 + (points[0].my - points[1].my) ** 2);\r\n                this._process_values.ra = Math.atan2(points[0].my - points[1].my, points[0].mx - points[1].mx);\r\n                activated_listener.click && (activated_listener.click = false);\r\n                break;\r\n        }\r\n    }\r\n\r\n    cursorDown = (e) => {\r\n        let t, points = this._points;\r\n        if (this._identifiers[0] !== InputListener.MOUSE_EVENT_ID) {\r\n            if (e.changedTouches && points.length < this._max_points) {\r\n                for (const touche of e.changedTouches) {\r\n                    if (this._identifiers.indexOf(touche.identifier) === -1) {\r\n                        t = touche;\r\n                        break;\r\n                    }\r\n\r\n                }\r\n            } else if (points.length === 0 && 2 ** e.button & this.mouse_mask) {\r\n                t = e;\r\n            }\r\n        }\r\n\r\n        if (t) {\r\n            this.addPoint(t, e);\r\n        }\r\n    }\r\n    _move = (e, t, index) => {\r\n        let listener = this._activated_listener;\r\n        let point = this._points[index];\r\n        let point_x = t[this.pointX];\r\n        let point_y = t[this.pointY];\r\n        if (listener.dragMove) {\r\n            let v2 = [point_x - point.mx, point_y - point.my];\r\n            if (listener.dragMove(e, v2, t)) {\r\n                point.mx = point_x - v2[0];\r\n                point.my = point_y - v2[1];\r\n            } else {\r\n                point.mx = point_x;\r\n                point.my = point_y;\r\n            }\r\n        }\r\n        //如果存在点击监听，则在拖拽距离超出极限后去除监听并\r\n        if (listener.click) {\r\n            if (Math.abs(point_x - point.dx) + Math.abs(point_y - point.dy) > this._mesh_value) {\r\n                listener.click = false;\r\n            }\r\n        }\r\n\r\n    }\r\n    _move2 = (e, t, index) => {\r\n        const STATES = InputListener.STATES;\r\n        let listener = this._activated_listener;\r\n        let values = this._process_values;\r\n        let points = this._points;\r\n        let target_point = points[index];\r\n        let sib_point = points[index === 1 ? 0 : 1];\r\n\r\n        let ox = t[this.pointX] - target_point.mx;\r\n        let oy = t[this.pointY] - target_point.my;\r\n        if (listener.dragMove2) {\r\n            let _v2 = [ox / 2, oy / 2];\r\n            if (listener.dragMove2(e, _v2, t)) {\r\n                ox -= _v2[0] * 2;\r\n                oy -= _v2[1] * 2;\r\n            }\r\n        }\r\n\r\n        target_point.mx = target_point.mx + ox;\r\n        target_point.my = target_point.my + oy;\r\n        let cx = (target_point.mx + sib_point.mx) / 2, cy = (target_point.my + sib_point.my) / 2;\r\n        if (listener.pinch) {\r\n            let _sd = Math.sqrt((target_point.mx - sib_point.mx) ** 2 + (target_point.my - sib_point.my) ** 2);\r\n            if (this._process_status & STATES.IS_PINCH) {\r\n                listener.pinch(e, -(values.sd - (values.sd = _sd)));\r\n            } else if (Math.abs(_sd - values.sd) > this._mesh_value) {\r\n                this._process_status |= STATES.IS_PINCH;\r\n                listener.pinch(e,\r\n                    -(values.sd - (values.sd = _sd)),\r\n                    [cx, cy]\r\n                );\r\n            }\r\n        }\r\n        if (listener.rotate) {\r\n            let reference_index = index === 0 ? 1 : index;\r\n            let dx = points[0].mx - points[reference_index].mx;\r\n            let dy = points[0].my - points[reference_index].my;\r\n            let _ra = Math.atan2(dy, dx);\r\n            _ra * values.ra <= 0 && (values.ra = -values.ra);\r\n            if (this._process_status & STATES.IS_ROTATE) {\r\n                listener.rotate(e, _ra - values.ra);\r\n                values.ra = _ra;\r\n            } else if (Math.abs(_ra - values.ra) > Math.PI * 0.01) {\r\n                this._process_status |= STATES.IS_ROTATE;\r\n                listener.rotate(e, _ra - values.ra, [cx, cy]);\r\n                values.ra = _ra;\r\n            }\r\n        }\r\n    }\r\n    cursorMove = (e) => {\r\n        this.eventDispenser(e, this._points.length < 2 ? this._move : this._move2);\r\n    }\r\n    _leave = (e, t, index) => {\r\n        this._identifiers.splice(index, 1);\r\n        this._points.splice(index, 1);\r\n        const STATES = InputListener.STATES;\r\n        let length = this._identifiers.length;\r\n        let listener = this._activated_listener;\r\n\r\n        switch (true) {\r\n            case length < 1:\r\n                this.setListener({\r\n                    [STATES.MOUSE_DOWN]: true,\r\n                    [STATES.MOUSE_MOVE]: false,\r\n                    [STATES.MOUSE_UP]: false,\r\n                    [STATES.TOUCH_MOVE]: false,\r\n                    [STATES.TOUCH_END]: false,\r\n                    [STATES.TOUCH_CANCEL]: false,\r\n                });\r\n                this._process_status = 0;\r\n                if (e) {\r\n                    listener.dragEnd && listener.dragEnd(e, t);\r\n                    listener.click && listener.click(e, t);\r\n                }\r\n                break;\r\n            case e && length < this._max_points:\r\n                this._process_status = STATES.IS_DRAG;\r\n                if (e.targetTouches && e.targetTouches.length >= this._max_points) {\r\n                    for (const touche of e.targetTouches) {\r\n                        if (this._identifiers.indexOf(touche.identifier) === -1) {\r\n                            this.registPoint(e, touche);\r\n                            break;\r\n                        }\r\n                    }\r\n                }\r\n                break;\r\n        }\r\n    }\r\n    cursorUp = (e) => {\r\n        this.eventDispenser(e, this._leave);\r\n    }\r\n    keyDown = (e) => {\r\n        let kd_tasks = this._process_values.kd_tasks;\r\n        function dispose_task(task) {\r\n            if (task) {\r\n                let cl_count = task._listeners ? task._listeners.length : 0;\r\n                for (let i = 0; i < cl_count; i++) {\r\n                    if (task._listeners[i](e, task._path) === true) {\r\n                        return true;\r\n                    }\r\n                }\r\n                task._reference > cl_count && kd_tasks.indexOf(task) === -1 && kd_tasks.push(task);\r\n            }\r\n        }\r\n        let keys = InputListener._PRIVATE_METHODS.get_keys(e);\r\n        if (!kd_tasks.some(task => keys.some(key => dispose_task(task[key])))) {\r\n            for (const key of keys) {\r\n                if (dispose_task(this._registered_listener.keyDown[key])) {\r\n                    break;\r\n                }\r\n            }\r\n        }\r\n    }\r\n    keyUp = (e) => {\r\n        let keys = InputListener._PRIVATE_METHODS.get_keys(e);\r\n        let kd_tasks = this._process_values.kd_tasks;\r\n        for (let i = 0; i < kd_tasks.length; i++) {\r\n            if (keys.some(key => kd_tasks[i]._parts.indexOf(key) !== -1)) {\r\n                kd_tasks.splice(i--, 1);\r\n            }\r\n        }\r\n        /*处理keyUp定义的监听*/\r\n        let listener = this._registered_listener.keyUp;\r\n        for (const key of keys) {\r\n            listener[key] && listener[key].some(task => task(e));\r\n        }\r\n    }\r\n    keyPress = (e) => {\r\n        let keys = InputListener._PRIVATE_METHODS.get_keys(e);\r\n        let listener = this._registered_listener.keyPress;\r\n        for (const key of keys) {\r\n            listener[key] && listener[key].some(task => task(e));\r\n        }\r\n    }\r\n    registListener(events) {\r\n        this.updateListener(events);\r\n    }\r\n    removeListener(events) {\r\n        if (events) {\r\n            this.updateListener(events, true);\r\n        } else {\r\n            //...\r\n        }\r\n    }\r\n}\r\n\r\ntry {\r\n    window.InputListener = InputListener;\r\n} catch (e) {\r\n}\r\nmodule.exports = InputListener;\r\n//export default InputListener;\r\n"],"sourceRoot":""}