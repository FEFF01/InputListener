{"version":3,"sources":["webpack:///webpack/universalModuleDefinition","webpack:///webpack/bootstrap","webpack:///./js/input_listener.js"],"names":["root","factory","exports","module","define","amd","a","i","window","installedModules","__webpack_require__","moduleId","l","modules","call","m","c","d","name","getter","o","Object","defineProperty","enumerable","get","r","Symbol","toStringTag","value","t","mode","__esModule","ns","create","key","bind","n","object","property","prototype","hasOwnProperty","p","s","CURSOR_PATTERN_MAP","Base","target","options","_activated_listener","_registered_listener","rotate","pinch","dragMove","dragStart","dragEnd","dragMove2","click","keyDown","_parts","_reference","keyUp","keyPress","_bm","_listener_options","undefined","_listener_status","_points","_identifiers","this","status","config","InputListener","EVENT_CONFIG","event","handle","addEventListener","removeEventListener","e","receiver","MOUSE_EVENT_ID","button","changedTouches","length","index","indexOf","identifier","MOUSE_DOWN","MOUSE_MOVE","MOUSE_UP","TOUCH_START","TOUCH_MOVE","TOUCH_END","TOUCH_CANCEL","KEY_DOWN","KEY_UP","KEY_PRESS","CURSOR_EVENT_HANDLES","keys","STATES","IS_DRAG","IS_ROTATE","IS_PINCH","PATTERN_MAP","_PRIVATE_METHODS","update_key_listener","storage","callback","is_remove","match_keys","callback_list","splice","push","str","match","map","toLocaleLowerCase","get_keys","code","_LISTENER_PREPROCESSOR","events","nodes","keygroups","slice","split","append_key","parent","key_code","is_last_child","child","_listeners","dec_ref","_parent","_key","concat","_path","join","forEach","keygroup","part","parts","curr_nodes","node","_mesh_value","devicePixelRatio","_process_status","_process_values","kd_tasks","cursorDown","points","_max_points","touche","listener_count","listeners","mask","reduce","res","activated_listener","_registPoint","_move","listener","point","v2","pageX","mx","pageY","my","Math","abs","dx","dy","_move2","values","target_point","sib_point","ox","oy","_v2","cx","cy","_sd","sqrt","sd","reference_index","_ra","atan2","ra","PI","cursorMove","eventDispenser","_leave","setListener","targetTouches","cursorUp","dispose_task","task","cl_count","some","registListener","updateListener","test","has_cursor","isNaN","is_mouse_event","_is_mouse_event"],"mappings":"CAAA,SAA2CA,EAAMC,GAChD,GAAsB,iBAAZC,SAA0C,iBAAXC,OACxCA,OAAOD,QAAUD,SACb,GAAqB,mBAAXG,QAAyBA,OAAOC,IAC9CD,OAAO,GAAIH,OACP,CACJ,IAAIK,EAAIL,IACR,IAAI,IAAIM,KAAKD,GAAuB,iBAAZJ,QAAuBA,QAAUF,GAAMO,GAAKD,EAAEC,IAPxE,CASGC,QAAQ,WACX,O,YCTE,IAAIC,EAAmB,GAGvB,SAASC,EAAoBC,GAG5B,GAAGF,EAAiBE,GACnB,OAAOF,EAAiBE,GAAUT,QAGnC,IAAIC,EAASM,EAAiBE,GAAY,CACzCJ,EAAGI,EACHC,GAAG,EACHV,QAAS,IAUV,OANAW,EAAQF,GAAUG,KAAKX,EAAOD,QAASC,EAAQA,EAAOD,QAASQ,GAG/DP,EAAOS,GAAI,EAGJT,EAAOD,QA0Df,OArDAQ,EAAoBK,EAAIF,EAGxBH,EAAoBM,EAAIP,EAGxBC,EAAoBO,EAAI,SAASf,EAASgB,EAAMC,GAC3CT,EAAoBU,EAAElB,EAASgB,IAClCG,OAAOC,eAAepB,EAASgB,EAAM,CAAEK,YAAY,EAAMC,IAAKL,KAKhET,EAAoBe,EAAI,SAASvB,GACX,oBAAXwB,QAA0BA,OAAOC,aAC1CN,OAAOC,eAAepB,EAASwB,OAAOC,YAAa,CAAEC,MAAO,WAE7DP,OAAOC,eAAepB,EAAS,aAAc,CAAE0B,OAAO,KAQvDlB,EAAoBmB,EAAI,SAASD,EAAOE,GAEvC,GADU,EAAPA,IAAUF,EAAQlB,EAAoBkB,IAC/B,EAAPE,EAAU,OAAOF,EACpB,GAAW,EAAPE,GAA8B,iBAAVF,GAAsBA,GAASA,EAAMG,WAAY,OAAOH,EAChF,IAAII,EAAKX,OAAOY,OAAO,MAGvB,GAFAvB,EAAoBe,EAAEO,GACtBX,OAAOC,eAAeU,EAAI,UAAW,CAAET,YAAY,EAAMK,MAAOA,IACtD,EAAPE,GAA4B,iBAATF,EAAmB,IAAI,IAAIM,KAAON,EAAOlB,EAAoBO,EAAEe,EAAIE,EAAK,SAASA,GAAO,OAAON,EAAMM,IAAQC,KAAK,KAAMD,IAC9I,OAAOF,GAIRtB,EAAoB0B,EAAI,SAASjC,GAChC,IAAIgB,EAAShB,GAAUA,EAAO4B,WAC7B,WAAwB,OAAO5B,EAAgB,SAC/C,WAA8B,OAAOA,GAEtC,OADAO,EAAoBO,EAAEE,EAAQ,IAAKA,GAC5BA,GAIRT,EAAoBU,EAAI,SAASiB,EAAQC,GAAY,OAAOjB,OAAOkB,UAAUC,eAAe1B,KAAKuB,EAAQC,IAGzG5B,EAAoB+B,EAAI,GAIjB/B,EAAoBA,EAAoBgC,EAAI,G,mzCChFrD,IAAMC,EAAqB,CACvB,OAAU,WACV,MAAS,UACT,UAAa,cACb,UAAa,cACb,SAAY,aACZ,QAAW,YACX,MAAS,WAQPC,E,WAwJF,WAAYC,EAAQC,GAAS,eAlH7BC,oBAAsB,GAkHO,KAjH7BC,qBAAuB,CACnBC,OAAQ,KAAMC,MAAO,KACrBC,SAAU,KAAMC,UAAW,KAAMC,QAAS,KAAMC,UAAW,KAC3DC,MAAO,KACPC,QAAS,CAAEC,OAAQ,GAAIC,WAAY,GAAKC,MAAO,CAAED,WAAY,GAAKE,SAAU,CAAEF,WAAY,IA6GjE,KA3G7BG,IAAM,EA2GuB,KAF7BhB,OAAS,KAEoB,KAD7BiB,uBAAoBC,EACS,KAK7BC,iBAAmB,GALU,KAqB7BC,QAAU,GArBmB,KAsB7BC,aAAe,GArBXC,KAAKtB,OAASA,EACdsB,KAAKL,kBAAoBhB,E,8CAIjBsB,GACR,IAAK,IAAMlC,KAAOkC,EACd,IAAKD,KAAKH,iBAAiB9B,KAASkC,EAAOlC,GAAM,CAC7C,IAAMmC,EAASC,EAAcC,aAAarC,GACpCsC,EAAQH,EAAO,GAAII,EAASJ,EAAO,GACnCxB,EAASwB,EAAO,IAAMF,KAAKtB,OAC7BuB,EAAOlC,GACPW,EAAO6B,iBAAiBF,EAAOL,KAAKM,GAASN,KAAKL,mBAElDjB,EAAO8B,oBAAoBH,EAAOL,KAAKM,GAASN,KAAKL,mBAEzDK,KAAKH,iBAAiB9B,KAASkC,EAAOlC,M,qCAMnC0C,EAAGC,GACd,GAAIV,KAAKD,aAAa,KAAOI,EAAcQ,eACnC,WAAKF,EAAEG,QAASZ,KAAKN,KACrBgB,EAASD,EAAGA,EAAG,QAEhB,GAAIA,EAAEI,eACT,IAAK,IAAIzE,EAAI,EAAGA,EAAIqE,EAAEI,eAAeC,OAAQ1E,IAAK,CAC9C,IAAI2E,EAAQf,KAAKD,aAAaiB,QAAQP,EAAEI,eAAezE,GAAG6E,aAC3C,IAAXF,GACAL,EAASD,EAAGA,EAAEI,eAAezE,GAAI2E,M,sCAM7C,OAAOf,KAAKD,aAAa,KAAOI,EAAcQ,mB,KA9LhDlC,EACK2B,aAAe,CAClBc,WAAY,CAAC,YAAa,cAC1BC,WAAY,CAAC,YAAa,aAAc9E,QACxC+E,SAAU,CAAC,UAAW,WAAY/E,QAClCgF,YAAa,CAAC,aAAc,cAC5BC,WAAY,CAAC,YAAa,aAAcjF,QACxCkF,UAAW,CAAC,WAAY,WAAYlF,QACpCmF,aAAc,CAAC,cAAe,WAAYnF,QAE1CoF,SAAU,CAAC,UAAW,WACtBC,OAAQ,CAAC,QAAS,SAClBC,UAAW,CAAC,WAAY,aAZ1BlD,EAcKmD,qBAAuB1E,OAAO2E,KAAKrD,GAdxCC,EAeKqD,OAAS,CACZC,QAAS,EACTC,UAAW,EACXC,SAAU,EAEVf,WAAY,aACZC,WAAY,aACZC,SAAU,WACVC,YAAa,cACbC,WAAY,aACZC,UAAW,YACXC,aAAc,eAEdC,SAAU,WACVC,OAAQ,SACRC,UAAW,aA9BblD,EAiCKyD,Y,mWACA1D,E,GAxCa,CACpB,QAAW,gBACX,MAAS,cACT,SAAY,mBAGVC,EA+CKkC,gBAAkB,iBA/CvBlC,EAiDK0D,iBAAmB,CACtBC,oBADsB,SACFC,EAAS/B,EAAQgC,EAAUC,GAC3CpC,EAAcgC,iBAAiBK,WAAWlC,GAAQ,SAAAvC,GAC9C,IAAI0E,EAAgBJ,EAAQtE,GAC5B0E,IAAkBA,EAAgBJ,EAAQtE,GAAO,IACjD,IAAIgD,EAAQ0B,EAAczB,QAAQsB,GAC7BC,EAGMxB,GAAS,IAChBsB,EAAQ9C,aACJkD,EAAc3B,OAAS,EACvB2B,EAAcC,OAAO3B,EAAO,UAErBsB,EAAQtE,KAPnBsE,EAAQ9C,cACPwB,GAAS0B,EAAcE,KAAKL,QAWzCE,WAnBsB,SAmBXI,EAAKN,GAEZ,IAAIT,EAAOe,EAAIC,MAAM,4BAErB,GADAhB,EAAOA,EAAOA,EAAKiB,KAAI,SAAA/E,GAAG,OAAIA,EAAIgF,uBAAuB,IACrDT,EAOA,OAAOT,EANP,MAAkBA,EAAlB,wDAAwB,qFACpB,GAAIS,EADgB,GAEhB,QAQhBU,SAlCsB,SAkCbvC,GACL,OAAQA,EAAEwC,MAAQxC,EAAE1C,MAAQ0C,EAAEwC,KAAQ,CAACxC,EAAE1C,IAAIgF,oBAAqBtC,EAAEwC,KAAKF,qBAAuB,CAACtC,EAAE1C,IAAIgF,uBApF7GtE,EAuFKyE,uBAAyB,CAC5B7D,QAD4B,SACpB8D,EAAQb,EAAUC,GAQtB,IACIa,EADAC,EAAYF,EAAOG,MAAM,GAAI,GAAGC,MAAM,KAEtCC,EAAajB,EAAY,SAAUkB,EAAQC,EAAUC,GACrD,GAAIA,EAAe,CACf,IAAIC,EAAQH,EAAOC,GACnB,GAAIE,EAAO,CACP,IAAI7C,EAAQ6C,EAAMC,WAAW7C,QAAQsB,IACtB,IAAXvB,IACA6C,EAAMC,WAAWnB,OAAO3B,EAAO,GAf/C,SAAS+C,EAAQF,GACb,IAAIH,EAASG,EAAMG,UACbH,EAAMrE,YAAc,GAAKkE,WACpBA,EAAOG,EAAMI,MACpBF,EAAQL,IAYAK,CAAQF,OAIpB,SAAUH,EAAQC,EAAUC,GAC5B,IAAIC,EAAQH,EAAOC,GACdE,KACDA,EAAQH,EAAOC,GAAY,CACvBK,QAASN,EACTO,KAAMN,EACNnE,WAAY,EACZD,OAAQmE,EAAOnE,OAAO2E,OAAOP,KAE3BQ,MAAQN,EAAMtE,OAAO6E,KAAK,KAChCV,EAAOlE,cAEX6D,EAAMT,KAAKiB,GACPD,IACAC,EAAMrE,aACNqE,EAAMC,YAAsD,IAAxCD,EAAMC,WAAW7C,QAAQsB,IAAoBsB,EAAMC,WAAWlB,KAAKL,GAAasB,EAAMC,WAAa,CAACvB,KAIhIe,EAAUe,SAAQ,SAAUC,GACxBjB,EAAQ,CAACpD,KAAKnB,qBAAqBQ,SACnCgF,EAASd,MAAM,KAAKa,SAAQ,SAAUE,EAAMvD,EAAOwD,GAC/C,IAAIC,EAAapB,EACbvB,EAAO1B,EAAcgC,iBAAiBK,WAAW8B,GACjDX,EAAgBY,EAAMzD,SAAWC,EAAQ,EAC7CqC,EAAQ,GACR,MAAmBoB,EAAnB,wDAA+B,yFAApBC,EAAoB,EAC3B,EAAkB5C,EAAlB,wDAAwB,qFACpB2B,EAAWiB,EADS,EACEd,OAG/B3D,QACJA,OAEPR,MAxD4B,SAwDtBc,EAAQgC,EAAUC,GACpBpC,EAAcgC,iBAAiBC,oBAAoBpC,KAAKnB,qBAAqBW,MAAOc,EAAQgC,EAAUC,IAE1G9C,SA3D4B,SA2DnBa,EAAQgC,EAAUC,GACvBpC,EAAcgC,iBAAiBC,oBAAoBpC,KAAKnB,qBAAqBY,SAAUa,EAAQgC,EAAUC,K,IA+C/GpC,E,YAMF,WAAYzB,EAAQyE,EAAQxE,GAAS,wBACjC,wBAAMD,EAAQC,KANlB+F,YAA+C,GAAhCrI,OAAOsI,kBAAoB,GAKL,EAJrCC,gBAAkB,EAImB,EAHrCC,gBAAkB,CACdC,SAAU,IAEuB,EAqFrCC,WAAa,SAACtE,GACV,IAAI/C,EAAGsH,EAAS,EAAKlF,QACrB,GAAI,EAAKC,aAAa,KAAOI,EAAcQ,eACvC,GAAIF,EAAEI,gBAAkBmE,EAAOlE,OAAS,EAAKmE,YACzC,OAAqBxE,EAAEI,eAAvB,wDAAuC,yFAA5BqE,EAA4B,EACnC,IAAsD,IAAlD,EAAKnF,aAAaiB,QAAQkE,EAAOjE,YAAoB,CACrDvD,EAAIwH,EACJ,aAIiB,IAAlBF,EAAOlE,QAAgB,WAAKL,EAAEG,QAAS,EAAKlB,MACnDhC,EAAI+C,GAIZ,GAAK/C,EAAL,CAIA,IAAIyH,EAAiBhF,EAAcyB,qBAAqBd,OACxD,GAAsB,IAAlBkE,EAAOlE,OAAc,CACrB,IAAIsE,EAAY,EAAKvG,qBACjBwG,EAAOD,EAAUnG,WAAamG,EAAUnG,UAAUwB,EAAG/C,KAAM,EAC/D,IAAa,IAAT2H,EACA,OAEJF,EAAiB,EACjBhF,EAAcyB,qBAAqB0D,QAC/B,SAACC,EAAKjF,GAOF,OANI8E,EAAU9E,MAAqB,IAAT+E,IAAmBA,EAAKrE,QAAQV,KACtD6E,IACAI,EAAIjF,GAAU8E,EAAU9E,WAEjBiF,EAAIjF,GAERiF,IACR,EAAK3G,sBAGZuG,EAAiB,GAAMA,EAAiB,IAAMK,mBAAmBvG,YACjE,EAAKwG,aAAahF,EAAG/C,KA9HQ,EAiIrCgI,MAAQ,SAACjF,EAAG/C,EAAGqD,GACX,IAAI4E,EAAW,EAAK/G,oBAChBgH,EAAQ,EAAK9F,QAAQiB,GACzB,GAAI4E,EAAS3G,SAAU,CACnB,IAAI6G,EAAK,CAACnI,EAAEoI,MAAQF,EAAMG,GAAIrI,EAAEsI,MAAQJ,EAAMK,IAC1CN,EAAS3G,SAASyB,EAAGoF,IACrBD,EAAMG,GAAKrI,EAAEoI,MAAQD,EAAG,GACxBD,EAAMK,GAAKvI,EAAEsI,MAAQH,EAAG,KAExBD,EAAMG,GAAKrI,EAAEoI,MACbF,EAAMK,GAAKvI,EAAEsI,OAIjBL,EAASvG,OACL8G,KAAKC,IAAIzI,EAAEoI,MAAQF,EAAMQ,IAAMF,KAAKC,IAAIzI,EAAEsI,MAAQJ,EAAMS,IAAM,EAAK3B,cACnEiB,EAASvG,OAAQ,IAjJQ,EAsJrCkH,OAAS,SAAC7F,EAAG/C,EAAGqD,GACZ,IAAMe,EAAS3B,EAAc2B,OACzB6D,EAAW,EAAK/G,oBAChB2H,EAAS,EAAK1B,gBACdG,EAAS,EAAKlF,QACd0G,EAAexB,EAAOjE,GACtB0F,EAAYzB,EAAiB,IAAVjE,EAAc,EAAI,GAErC2F,EAAKhJ,EAAEoI,MAAQU,EAAaT,GAC5BY,EAAKjJ,EAAEsI,MAAQQ,EAAaP,GAChC,GAAIN,EAASxG,UAAW,CACpB,IAAIyH,EAAM,CAACF,EAAK,EAAGC,EAAK,GACpBhB,EAASxG,UAAUsB,EAAGmG,KACtBF,GAAe,EAATE,EAAI,GACVD,GAAe,EAATC,EAAI,IAIlBJ,EAAaT,GAAKS,EAAaT,GAAKW,EAAIF,EAAaP,GAAKO,EAAaP,GAAKU,EAC5E,IAAIE,GAAML,EAAaT,GAAKU,EAAUV,IAAM,EAAGe,GAAMN,EAAaP,GAAKQ,EAAUR,IAAM,EACvF,GAAIN,EAAS5G,MAAO,CAChB,IAAIgI,EAAMb,KAAKc,KAAK,SAACR,EAAaT,GAAKU,EAAUV,GAAO,GAApC,SAAyCS,EAAaP,GAAKQ,EAAUR,GAAO,IAC5F,EAAKrB,gBAAkB9C,EAAOG,SAC9B0D,EAAS5G,MAAM0B,IAAK8F,EAAOU,IAAMV,EAAOU,GAAKF,KACtCb,KAAKC,IAAIY,EAAMR,EAAOU,IAAM,EAAKvC,cACxC,EAAKE,iBAAmB9C,EAAOG,SAC/B0D,EAAS5G,MAAM0B,IACT8F,EAAOU,IAAMV,EAAOU,GAAKF,IAC3B,CAACF,EAAIC,KAIjB,GAAInB,EAAS7G,OAAQ,CACjB,IAAIoI,EAA4B,IAAVnG,EAAc,EAAIA,EACpCqF,EAAKpB,EAAO,GAAGe,GAAKf,EAAOkC,GAAiBnB,GAC5CM,EAAKrB,EAAO,GAAGiB,GAAKjB,EAAOkC,GAAiBjB,GAC5CkB,EAAMjB,KAAKkB,MAAMf,EAAID,GACzBe,EAAMZ,EAAOc,IAAM,IAAMd,EAAOc,IAAOd,EAAOc,IAC1C,EAAKzC,gBAAkB9C,EAAOE,WAC9B2D,EAAS7G,OAAO2B,EAAG0G,EAAMZ,EAAOc,IAChCd,EAAOc,GAAKF,GACLjB,KAAKC,IAAIgB,EAAMZ,EAAOc,IAAgB,IAAVnB,KAAKoB,KACxC,EAAK1C,iBAAmB9C,EAAOE,UAC/B2D,EAAS7G,OAAO2B,EAAG0G,EAAMZ,EAAOc,GAAI,CAACR,EAAIC,IACzCP,EAAOc,GAAKF,KAlMa,EAsMrCI,WAAa,SAAC9G,GACV,EAAK+G,eAAe/G,EAAG,EAAKX,QAAQgB,OAAS,EAAI,EAAK4E,MAAQ,EAAKY,SAvMlC,EAyMrCmB,OAAS,SAAChH,EAAG/C,EAAGqD,GAAU,MACtB,EAAKhB,aAAa2C,OAAO3B,EAAO,GAChC,EAAKjB,QAAQ4C,OAAO3B,EAAO,GAC3B,IAAMe,EAAS3B,EAAc2B,OACzBhB,EAAS,EAAKf,aAAae,OAC3B6E,EAAW,EAAK/G,oBACpB,QAAQ,GACJ,KAAKkC,EAAS,EACV,EAAK4G,aAAL,OACK5F,EAAOZ,YAAa,GADzB,IAEKY,EAAOX,YAAa,GAFzB,IAGKW,EAAOV,UAAW,GAHvB,IAIKU,EAAOR,YAAa,GAJzB,IAKKQ,EAAOP,WAAY,GALxB,IAMKO,EAAON,cAAe,GAN3B,IAQA,EAAKoD,gBAAkB,EACvBe,EAASzG,SAAWyG,EAASzG,QAAQuB,EAAG/C,GACxCiI,EAASvG,OAASuG,EAASvG,MAAMqB,EAAG/C,GACpC,MACJ,KAAKoD,EAAS,EAAKmE,YAEf,GADA,EAAKL,gBAAkB9C,EAAOC,QAC1BtB,EAAEkH,eAAiBlH,EAAEkH,cAAc7G,QAAU,EAAKmE,YAClD,OAAqBxE,EAAEkH,cAAvB,wDAAsC,yFAA3BzC,EAA2B,EAClC,IAAsD,IAAlD,EAAKnF,aAAaiB,QAAQkE,EAAOjE,YAAoB,CACrD,EAAKwE,aAAahF,EAAGyE,GACrB,WAnOa,EA0OrC0C,SAAW,SAACnH,GACR,EAAK+G,eAAe/G,EAAG,EAAKgH,SA3OK,EA6OrCpI,QAAU,SAACoB,GACP,IAAIqE,EAAW,EAAKD,gBAAgBC,SACpC,SAAS+C,EAAaC,GAClB,GAAIA,EAAM,CAEN,IADA,IAAIC,EAAWD,EAAKjE,WAAaiE,EAAKjE,WAAW/C,OAAS,EACjD1E,EAAI,EAAGA,EAAI2L,EAAU3L,IAC1B,IAA0C,IAAtC0L,EAAKjE,WAAWzH,GAAGqE,EAAGqH,EAAK5D,OAC3B,OAAO,EAGf4D,EAAKvI,WAAawI,IAAwC,IAA5BjD,EAAS9D,QAAQ8G,IAAgBhD,EAASnC,KAAKmF,IAGrF,IAAIjG,EAAO1B,EAAcgC,iBAAiBa,SAASvC,GACnD,IAAKqE,EAASkD,MAAK,SAAAF,GAAI,OAAIjG,EAAKmG,MAAK,SAAAjK,GAAG,OAAI8J,EAAaC,EAAK/J,UAC1D,OAAkB8D,EAAlB,wDAAwB,yFAAb9D,EAAa,EACpB,GAAI8J,EAAa,EAAKhJ,qBAAqBQ,QAAQtB,IAC/C,SA9PqB,EAmQrCyB,MAAQ,SAACiB,GAGL,IAFA,IAAIoB,EAAO1B,EAAcgC,iBAAiBa,SAASvC,GAC/CqE,EAAW,EAAKD,gBAAgBC,SAFzB,cAIHjD,EAAKmG,MAAK,SAAAjK,GAAG,OAAyC,IAArC+G,EAAS1I,GAAGkD,OAAO0B,QAAQjD,OAC5C+G,EAASpC,OAAOtG,IAAK,GALlB,KAGFA,EAAI,EAAGA,EAAI0I,EAAShE,OAAQ1E,IAAK,EAAjCA,GAMT,IAAIuJ,EAAW,EAAK9G,qBAAqBW,MACzC,EAAkBqC,EAAlB,wDAAwB,yFAAb9D,EAAa,EACpB4H,EAAS5H,IAAQ4H,EAAS5H,GAAKiK,MAAK,SAAAF,GAAI,OAAIA,EAAKrH,QA9QpB,EAiRrChB,SAAW,SAACgB,GACR,IAAIoB,EAAO1B,EAAcgC,iBAAiBa,SAASvC,GAC/CkF,EAAW,EAAK9G,qBAAqBY,SACzC,EAAkBoC,EAAlB,wDAAwB,yFAAb9D,EAAa,EACpB4H,EAAS5H,IAAQ4H,EAAS5H,GAAKiK,MAAK,SAAAF,GAAI,OAAIA,EAAKrH,QAnRrD,EAAKwH,eAAe9E,GAFa,E,6QAIlC9C,EAAOiC,GACN,OAAOtC,KAAKkI,eAAL,KACF7H,EAAQiC,M,0BAGbjC,EAAOiC,GACP,OAAOtC,KAAKkI,eAAL,KACF7H,EAAQiC,IACV,K,iCAGHtC,KAAKkI,mB,gCAEC,WACNlI,KAAK0H,YAAYxK,OAAO2E,KAAK7B,KAAKH,kBAAkByF,QAAO,SAACC,EAAKxH,GAE7D,OADA,EAAK8B,iBAAiB9B,KAASwH,EAAIxH,IAAO,GACnCwH,IACR,O,qCAEQpC,EAAQZ,GAAW,MAC1BoD,EAAW3F,KAAKnB,qBACdiD,EAAS3B,EAAc2B,OAC7B,GAAIqB,EACA,IAAK,IAAIpG,KAAQoG,EACb,IAAK,IAAI7C,KAAUH,EAAc+B,YACzB/B,EAAc+B,YAAY5B,GAAQ6H,KAAKpL,KACnCoD,EAAc+C,uBAAuB5C,GACrC6C,EAAOpG,IACHoD,EAAc+C,uBAAuB5C,GAAQ3D,KAAKqD,KAAMjD,EAAMoG,EAAOpG,GAAOwF,GAEhFoD,EAASrF,GAAUiC,EAAY,KAAOY,EAAOpG,IAMjEiD,KAAKiF,YAAcU,EAAS5G,OAAS4G,EAAS7G,QAAU6G,EAASxG,UAAY,EAAI,EAEjF,IAAIiJ,KAAazC,EAAS1G,WAAa0G,EAAS3G,UAAY2G,EAASxG,WAAawG,EAASzG,SACvFyG,EAASvG,OAASuG,EAAS5G,OAAS4G,EAAS7G,QAQjD,OAPAkB,KAAK0H,aAAL,OACK5F,EAAOZ,WAAakH,GADzB,IAEKtG,EAAOT,YAAc+G,GAF1B,IAGKtG,EAAOL,SAAWkE,EAAStG,QAAQE,WAAa,GAHrD,IAIKuC,EAAOJ,OAASiE,EAAStG,QAAQE,WAAa,GAAKoG,EAASnG,MAAMD,WAAa,GAJpF,IAKKuC,EAAOH,UAAYgE,EAASlG,SAASF,WAAa,GALvD,IAOOS,O,mCAEES,EAAG/C,GAAG,MACToE,EAAS3B,EAAc2B,OACzBkD,EAAShF,KAAKF,QACd0F,EAAqBxF,KAAKpB,oBAS9B,OARAoG,EAAOrC,KAAK,CACRyD,GAAI1I,EAAEoI,MACNO,GAAI3I,EAAEsI,MACND,GAAIrI,EAAEoI,MACNG,GAAIvI,EAAEsI,QAEVhG,KAAKD,aAAa4C,KAAK0F,MAAM3K,EAAEuD,YAAcd,EAAcQ,eAAiBjD,EAAEuD,YAEtE+D,EAAOlE,QACX,KAAK,EACDd,KAAK4E,gBAAkB9C,EAAOC,QAC9B,IAAIuG,EAAiBtI,KAAKuI,gBAC1BvI,KAAK0H,aAAL,OACK5F,EAAOZ,WAAaoH,GADzB,IAEKxG,EAAOX,WAAamH,GAFzB,IAGKxG,EAAOV,SAAWkH,GAHvB,IAIKxG,EAAOR,YAAcgH,GAJ1B,IAKKxG,EAAOP,WAAa+G,GALzB,IAMKxG,EAAON,cAAgB8G,GAN5B,IAQA,MACJ,KAAK,EACDtI,KAAK6E,gBAAgBoC,GAAKf,KAAKc,KAAK,SAAChC,EAAO,GAAGe,GAAKf,EAAO,GAAGe,GAAO,GAAjC,SAAsCf,EAAO,GAAGiB,GAAKjB,EAAO,GAAGiB,GAAO,IAC1GjG,KAAK6E,gBAAgBwC,GAAKnB,KAAKkB,MAAMpC,EAAO,GAAGiB,GAAKjB,EAAO,GAAGiB,GAAIjB,EAAO,GAAGe,GAAKf,EAAO,GAAGe,IAC3FP,EAAmBpG,QAAUoG,EAAmBpG,OAAQ,M,qCAuMrD+D,GACXnD,KAAKkI,eAAe/E,K,qCAETA,GACPA,GACAnD,KAAKkI,eAAe/E,GAAQ,O,GAnSZ1E,GA0S5B,IACIpC,OAAO8D,cAAgBA,EACzB,MAAOM,IAETzE,EAAOD,QAAUoE","file":"js/input_listener.js","sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory();\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine([], factory);\n\telse {\n\t\tvar a = factory();\n\t\tfor(var i in a) (typeof exports === 'object' ? exports : root)[i] = a[i];\n\t}\n})(window, function() {\nreturn "," \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 0);\n","\"use strict\";\r\n\r\nconst CURSOR_PATTERN_MAP = {\r\n    \"rotate\": /^rotate$/,\r\n    \"pinch\": /^pinch$/,\r\n    \"dragMove2\": /^dragMove2$/,\r\n    \"dragStart\": /^dragStart$/,\r\n    \"dragMove\": /^dragMove$/,\r\n    \"dragEnd\": /^dragEnd$/,\r\n    \"click\": /^click$/,\r\n}\r\nconst KEY_PATTERN_MAP = {\r\n    \"keyDown\": /^\\S+_keyDown$/,\r\n    \"keyUp\": /^\\S+_keyUp$/,\r\n    \"keyPress\": /^\\S+_keyPress$/,\r\n}\r\n\r\nclass Base {\r\n    static EVENT_CONFIG = {\r\n        MOUSE_DOWN: [\"mousedown\", \"cursorDown\"],\r\n        MOUSE_MOVE: [\"mousemove\", \"cursorMove\", window],\r\n        MOUSE_UP: [\"mouseup\", \"cursorUp\", window],\r\n        TOUCH_START: [\"touchstart\", \"cursorDown\"],\r\n        TOUCH_MOVE: [\"touchmove\", \"cursorMove\", window],\r\n        TOUCH_END: [\"touchend\", \"cursorUp\", window],\r\n        TOUCH_CANCEL: [\"touchcancel\", \"cursorUp\", window],\r\n\r\n        KEY_DOWN: [\"keydown\", \"keyDown\"],\r\n        KEY_UP: [\"keyup\", \"keyUp\"],\r\n        KEY_PRESS: [\"keypress\", \"keyPress\"],\r\n    };\r\n    static CURSOR_EVENT_HANDLES = Object.keys(CURSOR_PATTERN_MAP);\r\n    static STATES = {\r\n        IS_DRAG: 0b1,\r\n        IS_ROTATE: 0b10,\r\n        IS_PINCH: 0b100,\r\n\r\n        MOUSE_DOWN: \"MOUSE_DOWN\",\r\n        MOUSE_MOVE: \"MOUSE_MOVE\",\r\n        MOUSE_UP: \"MOUSE_UP\",\r\n        TOUCH_START: \"TOUCH_START\",\r\n        TOUCH_MOVE: \"TOUCH_MOVE\",\r\n        TOUCH_END: \"TOUCH_END\",\r\n        TOUCH_CANCEL: \"TOUCH_CANCEL\",\r\n\r\n        KEY_DOWN: \"KEY_DOWN\",\r\n        KEY_UP: \"KEY_UP\",\r\n        KEY_PRESS: \"KEY_PRESS\",\r\n    };\r\n\r\n    static PATTERN_MAP = {\r\n        ...CURSOR_PATTERN_MAP,\r\n        ...KEY_PATTERN_MAP\r\n    };\r\n\r\n    _activated_listener = {};\r\n    _registered_listener = {\r\n        rotate: null, pinch: null,\r\n        dragMove: null, dragStart: null, dragEnd: null, dragMove2: null,\r\n        click: null,\r\n        keyDown: { _parts: [], _reference: 0 }, keyUp: { _reference: 0 }, keyPress: { _reference: 0 }\r\n    };\r\n    _bm = 0x001;\r\n\r\n    static MOUSE_EVENT_ID = -9007199254740991;\r\n\r\n    static _PRIVATE_METHODS = {\r\n        update_key_listener(storage, handle, callback, is_remove) {\r\n            InputListener._PRIVATE_METHODS.match_keys(handle, key => {\r\n                let callback_list = storage[key];\r\n                callback_list || (callback_list = storage[key] = []);\r\n                let index = callback_list.indexOf(callback);\r\n                if (!is_remove) {\r\n                    storage._reference++;\r\n                    ~index || callback_list.push(callback);\r\n                } else if (index >= 0) {\r\n                    storage._reference--;\r\n                    if (callback_list.length > 1) {\r\n                        callback_list.splice(index, 1);\r\n                    } else {\r\n                        delete storage[key];\r\n                    }\r\n                }\r\n            });\r\n        },\r\n        match_keys(str, callback) {\r\n            //let keys = str.match(/(0x[0-9a-fA-F]+?|[0-9]+?)(?=0x|$|\\||\\,|\\+|\\_)/g) || [];\r\n            let keys = str.match(/(\\w+?|\\ )(?=$|\\||\\,|\\+)/g);\r\n            keys = keys ? keys.map(key => key.toLocaleLowerCase()) : [];\r\n            if (callback) {\r\n                for (const key of keys) {\r\n                    if (callback(key)) {\r\n                        break;\r\n                    }\r\n                }\r\n            } else {\r\n                return keys;\r\n            }\r\n\r\n        },\r\n        get_keys(e) {\r\n            return (e.code && e.key !== e.code) ? [e.key.toLocaleLowerCase(), e.code.toLocaleLowerCase()] : [e.key.toLocaleLowerCase()];\r\n        }\r\n    }\r\n    static _LISTENER_PREPROCESSOR = {\r\n        keyDown(events, callback, is_remove) {\r\n            function dec_ref(child) {\r\n                var parent = child._parent;\r\n                if (--child._reference <= 0 && parent) {\r\n                    delete parent[child._key];\r\n                    dec_ref(parent);\r\n                }\r\n            }\r\n            let keygroups = events.slice(0, -8).split(\",\"),\r\n                nodes;\r\n            let append_key = is_remove ? function (parent, key_code, is_last_child) {\r\n                if (is_last_child) {\r\n                    let child = parent[key_code];\r\n                    if (child) {\r\n                        let index = child._listeners.indexOf(callback);\r\n                        if (index !== -1) {\r\n                            child._listeners.splice(index, 1);\r\n                            dec_ref(child);\r\n                        }\r\n                    }\r\n                }\r\n            } : function (parent, key_code, is_last_child) {\r\n                let child = parent[key_code];\r\n                if (!child) {\r\n                    child = parent[key_code] = {\r\n                        _parent: parent,\r\n                        _key: key_code,\r\n                        _reference: 0,\r\n                        _parts: parent._parts.concat(key_code)\r\n                    };\r\n                    child._path = child._parts.join(\"+\");\r\n                    parent._reference++;\r\n                }\r\n                nodes.push(child);\r\n                if (is_last_child) {\r\n                    child._reference++;\r\n                    child._listeners ? (child._listeners.indexOf(callback) === -1 && child._listeners.push(callback)) : child._listeners = [callback];\r\n                }\r\n            };\r\n            /*解析相关的单键监听与组合键监听*/\r\n            keygroups.forEach(function (keygroup) {\r\n                nodes = [this._registered_listener.keyDown];\r\n                keygroup.split(\"+\").forEach(function (part, index, parts) {\r\n                    let curr_nodes = nodes,\r\n                        keys = InputListener._PRIVATE_METHODS.match_keys(part),//part.match(/(0x[0-9a-fA-F]+?|[0-9]+?)(?=0x|$|\\|)/g)\r\n                        is_last_child = parts.length === index + 1;\r\n                    nodes = [];\r\n                    for (const node of curr_nodes) {\r\n                        for (const key of keys) {\r\n                            append_key(node, key, is_last_child);\r\n                        }\r\n                    }\r\n                }, this);\r\n            }, this);\r\n        },\r\n        keyUp(handle, callback, is_remove) {\r\n            InputListener._PRIVATE_METHODS.update_key_listener(this._registered_listener.keyUp, handle, callback, is_remove);\r\n        },\r\n        keyPress(handle, callback, is_remove) {\r\n            InputListener._PRIVATE_METHODS.update_key_listener(this._registered_listener.keyPress, handle, callback, is_remove);\r\n        }\r\n    };\r\n    target = null;\r\n    _listener_options = undefined;\r\n    constructor(target, options) {\r\n        this.target = target;\r\n        this._listener_options = options;\r\n    }\r\n\r\n    _listener_status = {};\r\n    setListener(status) {\r\n        for (const key in status) {\r\n            if (!this._listener_status[key] != !status[key]) {\r\n                const config = InputListener.EVENT_CONFIG[key];\r\n                const event = config[0], handle = config[1];\r\n                const target = config[2] || this.target;\r\n                if (status[key]) {\r\n                    target.addEventListener(event, this[handle], this._listener_options);\r\n                } else {\r\n                    target.removeEventListener(event, this[handle], this._listener_options);\r\n                }\r\n                this._listener_status[key] = !!status[key];\r\n            }\r\n        }\r\n    }\r\n    _points = [];\r\n    _identifiers = [];\r\n    eventDispenser(e, receiver) {\r\n        if (this._identifiers[0] === InputListener.MOUSE_EVENT_ID) {\r\n            if (2 ** e.button & this._bm) {\r\n                receiver(e, e, 0);\r\n            }\r\n        } else if (e.changedTouches) {\r\n            for (let i = 0; i < e.changedTouches.length; i++) {\r\n                let index = this._identifiers.indexOf(e.changedTouches[i].identifier);\r\n                if (index !== -1) {\r\n                    receiver(e, e.changedTouches[i], index);\r\n                }\r\n            }\r\n        }\r\n    }\r\n    get _is_mouse_event() {\r\n        return this._identifiers[0] === InputListener.MOUSE_EVENT_ID;\r\n    }\r\n}\r\n\r\nclass InputListener extends Base {\r\n    _mesh_value = (window.devicePixelRatio || 1) * 4;\r\n    _process_status = 0;\r\n    _process_values = {\r\n        kd_tasks: []\r\n    };\r\n    constructor(target, events, options) {\r\n        super(target, options);\r\n        this.registListener(events);\r\n    }\r\n    on(event, callback) {\r\n        return this.updateListener({\r\n            [event]: callback\r\n        });\r\n    }\r\n    off(event, callback) {\r\n        return this.updateListener({\r\n            [event]: callback\r\n        }, true);\r\n    }\r\n    activate() {\r\n        this.updateListener();\r\n    }\r\n    disable() {\r\n        this.setListener(Object.keys(this._listener_status).reduce((res, key) => {\r\n            this._listener_status[key] && (res[key] = false);\r\n            return res;\r\n        }, {}));\r\n    }\r\n    updateListener(events, is_remove) {\r\n        let listener = this._registered_listener;\r\n        const STATES = InputListener.STATES;\r\n        if (events) {\r\n            for (let name in events) {\r\n                for (let handle in InputListener.PATTERN_MAP) {\r\n                    if (InputListener.PATTERN_MAP[handle].test(name)) {\r\n                        if (InputListener._LISTENER_PREPROCESSOR[handle]) {\r\n                            events[name] &&\r\n                                InputListener._LISTENER_PREPROCESSOR[handle].call(this, name, events[name], is_remove)\r\n                        } else {\r\n                            listener[handle] = is_remove ? null : events[name];\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n        }\r\n        this._max_points = listener.pinch || listener.rotate || listener.dragMove2 ? 2 : 1;\r\n\r\n        let has_cursor = listener.dragStart || listener.dragMove || listener.dragMove2 || listener.dragEnd ||\r\n            listener.click || listener.pinch || listener.rotate ? true : false;\r\n        this.setListener({\r\n            [STATES.MOUSE_DOWN]: has_cursor,\r\n            [STATES.TOUCH_START]: has_cursor,\r\n            [STATES.KEY_DOWN]: listener.keyDown._reference > 0,\r\n            [STATES.KEY_UP]: listener.keyDown._reference > 0 || listener.keyUp._reference > 0,\r\n            [STATES.KEY_PRESS]: listener.keyPress._reference > 0\r\n        });\r\n        return this;\r\n    }\r\n    _registPoint(e, t) {\r\n        const STATES = InputListener.STATES;\r\n        let points = this._points;\r\n        let activated_listener = this._activated_listener;\r\n        points.push({\r\n            dx: t.pageX,\r\n            dy: t.pageY,\r\n            mx: t.pageX,\r\n            my: t.pageY\r\n        });\r\n        this._identifiers.push(isNaN(t.identifier) ? InputListener.MOUSE_EVENT_ID : t.identifier);\r\n\r\n        switch (points.length) {\r\n            case 1:\r\n                this._process_status = STATES.IS_DRAG;\r\n                let is_mouse_event = this._is_mouse_event;\r\n                this.setListener({\r\n                    [STATES.MOUSE_DOWN]: is_mouse_event,\r\n                    [STATES.MOUSE_MOVE]: is_mouse_event,\r\n                    [STATES.MOUSE_UP]: is_mouse_event,\r\n                    [STATES.TOUCH_MOVE]: !is_mouse_event,\r\n                    [STATES.TOUCH_END]: !is_mouse_event,\r\n                    [STATES.TOUCH_CANCEL]: !is_mouse_event,\r\n                });\r\n                break;\r\n            case 2:\r\n                this._process_values.sd = Math.sqrt((points[0].mx - points[1].mx) ** 2 + (points[0].my - points[1].my) ** 2);\r\n                this._process_values.ra = Math.atan2(points[0].my - points[1].my, points[0].mx - points[1].mx);\r\n                activated_listener.click && (activated_listener.click = false);\r\n                break;\r\n        }\r\n    }\r\n    cursorDown = (e) => {\r\n        let t, points = this._points;\r\n        if (this._identifiers[0] !== InputListener.MOUSE_EVENT_ID) {\r\n            if (e.changedTouches && points.length < this._max_points) {\r\n                for (const touche of e.changedTouches) {\r\n                    if (this._identifiers.indexOf(touche.identifier) === -1) {\r\n                        t = touche;\r\n                        break;\r\n                    }\r\n\r\n                }\r\n            } else if (points.length === 0 && 2 ** e.button & this._bm) {\r\n                t = e;\r\n            }\r\n        }\r\n\r\n        if (!t) {\r\n            return;\r\n        }\r\n\r\n        let listener_count = InputListener.CURSOR_EVENT_HANDLES.length;\r\n        if (points.length === 0) {\r\n            let listeners = this._registered_listener;\r\n            let mask = listeners.dragStart && listeners.dragStart(e, t) || false;\r\n            if (mask === true) {\r\n                return;\r\n            }\r\n            listener_count = 0\r\n            InputListener.CURSOR_EVENT_HANDLES.reduce(\r\n                (res, handle) => {\r\n                    if (listeners[handle] && (mask === false || ~mask.indexOf(handle))) {\r\n                        listener_count++;\r\n                        res[handle] = listeners[handle];\r\n                    } else {\r\n                        delete res[handle];\r\n                    }\r\n                    return res;\r\n                }, this._activated_listener\r\n            )\r\n        }\r\n        if (listener_count > 1 || (listener_count > 0 && !activated_listener.dragStart)) {\r\n            this._registPoint(e, t);\r\n        }\r\n    }\r\n    _move = (e, t, index) => {\r\n        let listener = this._activated_listener;\r\n        let point = this._points[index];\r\n        if (listener.dragMove) {\r\n            var v2 = [t.pageX - point.mx, t.pageY - point.my];\r\n            if (listener.dragMove(e, v2)) {\r\n                point.mx = t.pageX - v2[0];\r\n                point.my = t.pageY - v2[1];\r\n            } else {\r\n                point.mx = t.pageX;\r\n                point.my = t.pageY;\r\n            }\r\n        }\r\n        //如果存在点击监听，则在拖拽距离超出极限后去除监听并\r\n        if (listener.click) {\r\n            if (Math.abs(t.pageX - point.dx) + Math.abs(t.pageY - point.dy) > this._mesh_value) {\r\n                listener.click = false;\r\n            }\r\n        }\r\n\r\n    }\r\n    _move2 = (e, t, index) => {\r\n        const STATES = InputListener.STATES;\r\n        let listener = this._activated_listener;\r\n        let values = this._process_values;\r\n        let points = this._points;\r\n        let target_point = points[index];\r\n        let sib_point = points[index === 1 ? 0 : 1];\r\n        //target_point.mx = t.pageX, target_point.my = t.pageY;\r\n        let ox = t.pageX - target_point.mx;\r\n        let oy = t.pageY - target_point.my;\r\n        if (listener.dragMove2) {\r\n            let _v2 = [ox / 2, oy / 2];\r\n            if (listener.dragMove2(e, _v2)) {\r\n                ox -= _v2[0] * 2;\r\n                oy -= _v2[1] * 2;\r\n            }\r\n        }\r\n\r\n        target_point.mx = target_point.mx + ox, target_point.my = target_point.my + oy;\r\n        let cx = (target_point.mx + sib_point.mx) / 2, cy = (target_point.my + sib_point.my) / 2;\r\n        if (listener.pinch) {\r\n            let _sd = Math.sqrt((target_point.mx - sib_point.mx) ** 2 + (target_point.my - sib_point.my) ** 2);\r\n            if (this._process_status & STATES.IS_PINCH) {\r\n                listener.pinch(e, -(values.sd - (values.sd = _sd)));\r\n            } else if (Math.abs(_sd - values.sd) > this._mesh_value) {\r\n                this._process_status |= STATES.IS_PINCH;\r\n                listener.pinch(e,\r\n                    -(values.sd - (values.sd = _sd)),\r\n                    [cx, cy]\r\n                );\r\n            }\r\n        }\r\n        if (listener.rotate) {\r\n            let reference_index = index === 0 ? 1 : index;\r\n            let dx = points[0].mx - points[reference_index].mx;\r\n            let dy = points[0].my - points[reference_index].my;\r\n            let _ra = Math.atan2(dy, dx);\r\n            _ra * values.ra <= 0 && (values.ra = - values.ra);\r\n            if (this._process_status & STATES.IS_ROTATE) {\r\n                listener.rotate(e, _ra - values.ra);\r\n                values.ra = _ra;\r\n            } else if (Math.abs(_ra - values.ra) > Math.PI * 0.01) {\r\n                this._process_status |= STATES.IS_ROTATE;\r\n                listener.rotate(e, _ra - values.ra, [cx, cy]);\r\n                values.ra = _ra;\r\n            }\r\n        }\r\n    }\r\n    cursorMove = (e) => {\r\n        this.eventDispenser(e, this._points.length < 2 ? this._move : this._move2);\r\n    }\r\n    _leave = (e, t, index) => {\r\n        this._identifiers.splice(index, 1);\r\n        this._points.splice(index, 1);\r\n        const STATES = InputListener.STATES;\r\n        let length = this._identifiers.length;\r\n        let listener = this._activated_listener;\r\n        switch (true) {\r\n            case length < 1:\r\n                this.setListener({\r\n                    [STATES.MOUSE_DOWN]: true,\r\n                    [STATES.MOUSE_MOVE]: false,\r\n                    [STATES.MOUSE_UP]: false,\r\n                    [STATES.TOUCH_MOVE]: false,\r\n                    [STATES.TOUCH_END]: false,\r\n                    [STATES.TOUCH_CANCEL]: false,\r\n                });\r\n                this._process_status = 0;\r\n                listener.dragEnd && listener.dragEnd(e, t);\r\n                listener.click && listener.click(e, t);\r\n                break;\r\n            case length < this._max_points:\r\n                this._process_status = STATES.IS_DRAG;\r\n                if (e.targetTouches && e.targetTouches.length >= this._max_points) {\r\n                    for (const touche of e.targetTouches) {\r\n                        if (this._identifiers.indexOf(touche.identifier) === -1) {\r\n                            this._registPoint(e, touche);\r\n                            break;\r\n                        }\r\n                    }\r\n                }\r\n                break;\r\n        }\r\n    }\r\n    cursorUp = (e) => {\r\n        this.eventDispenser(e, this._leave);\r\n    }\r\n    keyDown = (e) => {\r\n        let kd_tasks = this._process_values.kd_tasks;\r\n        function dispose_task(task) {\r\n            if (task) {\r\n                let cl_count = task._listeners ? task._listeners.length : 0;\r\n                for (let i = 0; i < cl_count; i++) {\r\n                    if (task._listeners[i](e, task._path) === true) {\r\n                        return true;\r\n                    }\r\n                }\r\n                task._reference > cl_count && kd_tasks.indexOf(task) === -1 && kd_tasks.push(task);\r\n            }\r\n        }\r\n        let keys = InputListener._PRIVATE_METHODS.get_keys(e);\r\n        if (!kd_tasks.some(task => keys.some(key => dispose_task(task[key])))) {\r\n            for (const key of keys) {\r\n                if (dispose_task(this._registered_listener.keyDown[key])) {\r\n                    break;\r\n                }\r\n            }\r\n        }\r\n    }\r\n    keyUp = (e) => {\r\n        let keys = InputListener._PRIVATE_METHODS.get_keys(e);\r\n        let kd_tasks = this._process_values.kd_tasks;\r\n        for (let i = 0; i < kd_tasks.length; i++) {\r\n            if (keys.some(key => kd_tasks[i]._parts.indexOf(key) !== -1)) {\r\n                kd_tasks.splice(i--, 1);\r\n            }\r\n        }\r\n        /*处理keyUp定义的监听*/\r\n        let listener = this._registered_listener.keyUp;\r\n        for (const key of keys) {\r\n            listener[key] && listener[key].some(task => task(e));\r\n        }\r\n    }\r\n    keyPress = (e) => {\r\n        let keys = InputListener._PRIVATE_METHODS.get_keys(e);\r\n        let listener = this._registered_listener.keyPress;\r\n        for (const key of keys) {\r\n            listener[key] && listener[key].some(task => task(e));\r\n        }\r\n    }\r\n    registListener(events) {\r\n        this.updateListener(events);\r\n    }\r\n    removeListener(events) {\r\n        if (events) {\r\n            this.updateListener(events, true);\r\n        } else {\r\n            //...\r\n        }\r\n    }\r\n}\r\n\r\ntry {\r\n    window.InputListener = InputListener;\r\n} catch (e) {\r\n}\r\nmodule.exports = InputListener;\r\n//export default InputListener;\r\n"],"sourceRoot":""}